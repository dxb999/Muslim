<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ميزان أعمالي</title>
<style>
  body{font-family:Tahoma,Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;text-align:center}
  h1{color:#2e7d32;margin:0 0 10px}

  /* أعمدة الحسنات/السيئات */
  .container{display:flex;justify-content:center;gap:40px;flex-wrap:wrap;margin-top:24px}
  .column{background:#fff;padding:20px;width:300px;border-radius:10px;box-shadow:0 0 10px #ccc}
  .column h2{margin:0 0 8px}
  input,button,select{padding:8px;margin:5px;width:80%}
  ul{list-style:none;padding:0;margin:12px 0}
  li{margin-bottom:6px;background:#e0f2f1;padding:8px;border-radius:6px;cursor:pointer}
  .summary{margin:18px 0 24px;font-size:1.1em;color:#333}

  /* تذكير */
  .reminder-box{background:#fff3cd;color:#856404;border:1px solid #ffeeba;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
  .reminder-box button{background:#ffc107;border:none;padding:10px 20px;font-size:1em;border-radius:6px;cursor:pointer}

  /* عداد القبر */
  .grave-meter-box{background:#fdecea;color:#611a15;border:1px solid #f5c6cb;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
  .progress-container{background:#f8d7da;border-radius:20px;overflow:hidden;height:25px;margin:10px 0}
  .progress-bar{height:100%;width:0%;background:#dc3545;transition:width .45s}

  /* التخفيف */
  .mitigation-box{background:#e9f3ff;color:#0f3b79;border:1px solid #cfe3ff;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
  .miti-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  .miti-buttons button{padding:10px 14px;border:none;border-radius:8px;background:#1976d2;color:#fff;cursor:pointer}
  .miti-note{margin-top:8px;font-size:.95em}

  /* إنفوجرافيك الأسباب */
  .infobox{background:#fff;border:1px solid #eaeaea;color:#1b1b1b;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
  .two-cols{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  @media(max-width:820px){.two-cols{grid-template-columns:1fr}}
  .infosec{border:1px dashed #ebebeb;border-radius:10px;padding:12px}
  .infosec h3{margin:0 0 10px}
  .infogrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px;justify-items:center}
  .sec-actions{margin-top:8px}
  .sec-actions button{padding:8px 12px;border:none;border-radius:8px;background:#555;color:#fff;cursor:pointer}

  /* الدائرة الكبيرة */
  .reason{width:140px;height:170px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;user-select:none}
  .ringwrap{position:relative;width:140px;height:140px}
  .ringwrap .inner{
    position:absolute;inset:28px;border-radius:50%;background:#fff;
    display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;text-align:center;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
  }
  .inner .icon{font-size:30px;line-height:1}
  .inner .title{font-size:14px;color:#222}
  .inner .times{font-size:12px;color:#666}

  /* عدّاد صغير */
  .count{position:absolute;bottom:-8px;right:-8px;background:#2e7d32;color:#fff;font-size:12px;border-radius:14px;padding:3px 8px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
  .bad .count{background:#dc3545}

  /* SVG حلقة التقدم — سماكة 30 + Glow */
  .svg{transform:rotate(-90deg)}
  .track{stroke:#e5e5e5;stroke-width:30;fill:none}
  .prog-good{stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(46,125,50,.6))}
  .prog-bad {stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(220,53,69,.6))}

  /* الجزاء النهائي */
  .final-judgment-box{background:#e8f5e9;color:#1b5e20;border:1px solid #c8e6c9;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
  .judgment-container{display:flex;justify-content:center;align-items:center;margin:20px 0;gap:30px}
  .judgment-column{width:100px;text-align:center}
  .judgment-meter{width:40px;height:200px;background:#ddd;border-radius:20px;position:relative;overflow:hidden}
  #judgmentIndicator{position:absolute;width:100%;height:0%;bottom:0;background:linear-gradient(to top,#dc3545,#ffc107,#4caf50);transition:height .45s}
</style>
</head>
<body>
  <h1>📖 ميزان أعمالي</h1>

  <!-- الحسنات / السيئات -->
  <div class="container">
    <div class="column" id="good">
      <h2>✅ الحسنات</h2>
      <input type="text" id="goodDesc" placeholder="وصف العمل" />
      <input type="number" id="goodPoints" placeholder="الدرجة" />
      <ul id="goodList"></ul>
      <strong>المجموع: <span id="goodTotal">0</span></strong>
    </div>

    <div class="column" id="bad">
      <h2>❌ السيئات</h2>
      <input type="text" id="badDesc" placeholder="وصف العمل" />
      <input type="number" id="badPoints" placeholder="الدرجة" />
      <ul id="badList"></ul>
      <strong>المجموع: <span id="badTotal">0</span></strong>
    </div>
  </div>

  <div class="summary">⚖️ الفارق = <span id="netResult">0</span> نقطة</div>

  <!-- تذكير -->
  <div class="reminder-box">
    <h2>☠️ عذاب القبر – تذكير وتحذير</h2>
    <p id="reminderText">اضغط على الزر لتتذكر الآخرة...</p>
    <button onclick="showReminder()">ذكرني اليوم</button>
  </div>

  <!-- عداد القبر -->
  <div class="grave-meter-box">
    <h2>📉 عداد عذاب القبر</h2>
    <div class="progress-container"><div id="graveProgress" class="progress-bar"></div></div>
    <p id="graveLevel">المستوى: آمن</p>
  </div>

  <!-- التخفيف -->
  <div class="mitigation-box">
    <h2>🛡️ التخفيف من عذاب القبر</h2>
    <div class="miti-buttons">
      <button onclick="applyMitigation('tawba')">توبة نصوح</button>
      <button onclick="applyMitigation('surahMulk')">سورة الملك ليلاً</button>
      <button onclick="applyMitigation('repayDebt')">سداد دين/رد مظلمة</button>
      <button onclick="applyMitigation('cutNamimah')">قطع النميمة</button>
    </div>
    <div id="mitigationNote" class="miti-note">كل خيار متاح مرة كل 24 ساعة.</div>
  </div>

  <!-- إنفوجرافيك: الجنة والنار -->
  <div class="infobox">
    <h2>🧭 أسباب دخول الجنة والنار</h2>
    <div class="two-cols">
      <div class="infosec">
        <h3>🌴 أسباب دخول الجنة</h3>
        <div class="infogrid" id="reasonsGoodGrid"></div>
        <div class="sec-actions"><button onclick="resetSection('good')">تصفير الجنة</button></div>
      </div>
      <div class="infosec">
        <h3>🔥 أسباب دخول النار</h3>
        <div class="infogrid" id="reasonsBadGrid"></div>
        <div class="sec-actions"><button onclick="resetSection('bad')">تصفير النار</button></div>
      </div>
    </div>
    <div style="margin-top:8px;font-size:.9em;color:#666">💾 يتم الحفظ تلقائيًا.</div>
  </div>

  <!-- الجزاء النهائي -->
  <div class="final-judgment-box">
    <h2>🌌 الجزاء النهائي</h2>
    <div class="judgment-container">
      <div class="judgment-column"><h3>🌴 الجنة</h3></div>
      <div class="judgment-meter"><div id="judgmentIndicator"></div></div>
      <div class="judgment-column"><h3>🔥 النار</h3></div>
    </div>
    <p id="judgmentResult">⬅️ يتم حساب المصير تلقائيًا حسب أعمالك...</p>
  </div>

<script>
  /* مجاميع الميزان */
  let goodTotal=0, badTotal=0;

  /* معاملات التخفيف */
  const K_GOOD=0.6;
  const MITIGATION_POINTS={tawba:25,surahMulk:10,repayDebt:35,cutNamimah:20};
  let mitigationTotal=0;

  function addEntry(type){
    const desc=document.getElementById(`${type}Desc`).value;
    const points=parseInt(document.getElementById(`${type}Points`).value);
    if(!desc||isNaN(points))return;
    const list=document.getElementById(`${type}List`);
    const li=document.createElement('li');
    li.textContent=`${desc} (${points} نقطة)`;
    li.onclick=()=>{list.removeChild(li); if(type==='good'){goodTotal-=points;document.getElementById('goodTotal').textContent=goodTotal;} else {badTotal-=points;document.getElementById('badTotal').textContent=badTotal;} updateAll();};
    list.appendChild(li);
    if(type==='good'){goodTotal+=points;document.getElementById('goodTotal').textContent=goodTotal;} else {badTotal+=points;document.getElementById('badTotal').textContent=badTotal;}
    document.getElementById(`${type}Desc`).value=''; document.getElementById(`${type}Points`).value='';
    updateAll();
  }

  function updateAll(){updateNetResult();updateGraveMeter();autoUpdateFinalJudgment();}

  function updateNetResult(){document.getElementById('netResult').textContent = goodTotal - badTotal;}

  function showReminder(){
    const reminders=["كان عثمان بن عفان إذا ذُكر القبر بكى حتى تبتل لحيته.","القبر أول منازل الآخرة، فإن نجا منه فما بعده أيسر.","أكثروا من ذكر هادم اللذات: الموت.","اللهم قِنا عذاب القبر، وثبّتنا عند السؤال.","استعدوا للقبر، فإن الليل والنهار يعملان فيكم."];
    document.getElementById('reminderText').textContent = reminders[Math.floor(Math.random()*reminders.length)];
  }

  function canUseMitigation(k){const t=localStorage.getItem('miti_'+k); if(!t) return true; return ((Date.now()-parseInt(t,10))/(1000*60*60))>=24;}
  function markMitigationUsed(k){localStorage.setItem('miti_'+k,Date.now().toString());}
  function applyMitigation(k){
    const note=document.getElementById('mitigationNote');
    if(!MITIGATION_POINTS[k])return;
    if(!canUseMitigation(k)){note.textContent="⏳ هذا الخيار استُخدم خلال آخر 24 ساعة.";return;}
    mitigationTotal+=MITIGATION_POINTS[k]; markMitigationUsed(k);
    note.textContent="✅ تم التخفيف. اثبت على الطاعة."; updateAll();
  }

  function computeGraveRisk(){
    let risk=badTotal - K_GOOD*goodTotal - mitigationTotal;
    if(risk<0)risk=0; if(risk>100)risk=100; return Math.round(risk);
  }
  function updateGraveMeter(){
    const risk=computeGraveRisk();
    document.getElementById('graveProgress').style.width=risk+'%';
    let label="آمن";
    if(risk>10&&risk<=30)label="تحذير بسيط";
    else if(risk>30&&risk<=60)label="خطر متوسط ⚠️";
    else if(risk>60&&risk<90)label="اقتراب من العذاب 😟";
    else if(risk>=90)label="🔥 شديد الخطر – تب قبل فوات الأوان";
    document.getElementById('graveLevel').textContent='المستوى: '+label;
  }

  function autoUpdateFinalJudgment(){
    const net=goodTotal-badTotal;
    let h=50, txt="⚖️ تعادل الحساب، فكن من المستغفرين.";
    if(net>100){h=100;txt="🥇 أعمالك عظيمة، وجهتك الجنة بإذن الله!";}
    else if(net>50){h=80;txt="🌿 مصيرك الجنة إن شاء الله، واصل الثبات.";}
    else if(net>0){h=65;txt="🤲 على الطريق، واصل العمل الصالح.";}
    else if(net===0){h=50;txt="⚖️ تعادل الحساب، فكن من المستغفرين.";}
    else if(net>-30){h=35;txt="❗ خطر! راجع نفسك قبل فوات الأوان.";}
    else if(net>-70){h=20;txt="🔥 تسارع نحو الخطر، بادر بالتوبة.";}
    else {h=5;txt="🚫 مصيرك النار إن لم تتب، اللهم سلم!";}
    document.getElementById('judgmentIndicator').style.height=h+'%';
    document.getElementById('judgmentResult').textContent=txt;
  }

  /* ===== الإنفوجرافيك (20 ضغطة) — عرض 30 + تدرّج + Glow + حفظ تلقائي + تصفير ===== */
  const MAX_CLICKS = 20;
  const REASONS_GOOD=[
    {id:'iman',icon:'🕋',label:'الإيمان',points:25},
    {id:'salah',icon:'🕌',label:'الصلاة',points:20},
    {id:'birr',icon:'👨‍👩‍👧‍👦',label:'برّ الوالدين',points:18},
    {id:'sadaqa',icon:'🤝',label:'الصدقة',points:15},
    {id:'siyam',icon:'🌙',label:'الصوم',points:12},
    {id:'silah',icon:'🧬',label:'صلة الرحم',points:12}
  ];
  const REASONS_BAD=[
    {id:'kufr',icon:'🚫',label:'الكفر/الشرك',points:40},
    {id:'tarkSalah',icon:'⛔️',label:'ترك الصلاة',points:30},
    {id:'uquq',icon:'💢',label:'عقوق الوالدين',points:25},
    {id:'zina',icon:'⚠️',label:'الزنا',points:35},
    {id:'riba',icon:'💸',label:'الربا',points:25},
    {id:'namimahR',icon:'🗣️',label:'النميمة',points:15}
  ];

  const clicks = {}; // {id: count}

  function gradientStops(type){
    return type==='bad' ? ['#dc3545','#ff7043'] : ['#2e7d32','#66bb6a'];
  }

  function saveClicks(){
    localStorage.setItem('reasons_good', JSON.stringify(REASONS_GOOD.map(r=>({id:r.id,count:clicks[r.id]||0}))));
    localStorage.setItem('reasons_bad',  JSON.stringify(REASONS_BAD.map(r=>({id:r.id,count:clicks[r.id]||0}))));
  }

  function loadClicks(){
    try{
      const g = JSON.parse(localStorage.getItem('reasons_good')||'[]');
      const b = JSON.parse(localStorage.getItem('reasons_bad')||'[]');
      return {good:g, bad:b};
    }catch{ return {good:[],bad:[]}; }
  }

  function createReasonEl(r,type,grid){
    clicks[r.id]=0;

    const size=140, r0=50, cx=size/2, cy=size/2, C=2*Math.PI*r0;
    const gradId=`grad_${type}_${r.id}`;

    const wrap=document.createElement('div');
    wrap.className='reason '+(type==='bad'?'bad':'good');
    wrap.id='reason_'+r.id;

    const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';

    const [c1,c2]=gradientStops(type);
    ringwrap.innerHTML=`
      <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
        <defs>
          <linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%"  stop-color="${c1}"></stop>
            <stop offset="100%" stop-color="${c2}"></stop>
          </linearGradient>
        </defs>
        <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
        <circle class="${type==='bad'?'prog-bad':'prog-good'}"
                id="prog_${r.id}"
                cx="${cx}" cy="${cy}" r="${r0}"
                stroke="url(#${gradId})"
                stroke-linecap="round"
                stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
      </svg>
    `;

    const inner=document.createElement('div'); inner.className='inner';
    inner.innerHTML=`
      <div class="icon">${r.icon}</div>
      <div class="title">${r.label}</div>
      <div class="times"><span id="t_${r.id}">0</span>×</div>
    `;

    const count=document.createElement('div'); count.className='count'; count.textContent='0×';

    ringwrap.appendChild(inner);
    ringwrap.appendChild(count);
    wrap.appendChild(ringwrap);

    function setVisual(countVal){
      const pct = countVal / MAX_CLICKS;
      const offset = C * (1 - pct);
      const prog = document.getElementById('prog_'+r.id);
      prog.style.strokeDashoffset = offset;
      document.getElementById('t_'+r.id).textContent = countVal;
      count.textContent = countVal+'×';
    }

    wrap.onclick=()=>{
      if(clicks[r.id] >= MAX_CLICKS) return;
      clicks[r.id]++;

      if(type==='good'){ goodTotal += r.points; document.getElementById('goodTotal').textContent=goodTotal; }
      else { badTotal  += r.points; document.getElementById('badTotal').textContent=badTotal; }

      setVisual(clicks[r.id]);
      saveClicks();
      updateAll();
    };

    wrap._meta = {setVisual};
    grid.appendChild(wrap);
  }

  function renderReasons(){
    const gGrid=document.getElementById('reasonsGoodGrid');
    const bGrid=document.getElementById('reasonsBadGrid');
    REASONS_GOOD.forEach(r=>createReasonEl(r,'good',gGrid));
    REASONS_BAD.forEach(r=>createReasonEl(r,'bad',bGrid));
  }

  /* استرجاع الحالة المحفوظة */
  function restoreFromStorage(){
    const saved = loadClicks();
    goodTotal = 0; badTotal = 0;

    function applySaved(list, type, defs){
      list.forEach(({id,count})=>{
        const el = document.getElementById('reason_'+id);
        const def = defs.find(d=>d.id===id);
        if(!el || !def) return;
        const c = Math.min(MAX_CLICKS, Math.max(0, parseInt(count)||0));
        clicks[id] = c;
        if(el._meta) el._meta.setVisual(c);
        if(type==='good') goodTotal += def.points * c;
        else badTotal += def.points * c;
      });
    }

    applySaved(saved.good||[], 'good', REASONS_GOOD);
    applySaved(saved.bad||[],  'bad',  REASONS_BAD);

    document.getElementById('goodTotal').textContent = goodTotal;
    document.getElementById('badTotal').textContent = badTotal;
    updateAll();
  }

  /* تصفير قسم */
  function resetSection(type){
    const defs = (type==='good') ? REASONS_GOOD : REASONS_BAD;
    defs.forEach(def=>{
      const el = document.getElementById('reason_'+def.id);
      const curr = clicks[def.id]||0;
      if(curr>0){
        if(type==='good'){ goodTotal -= def.points*curr; if(goodTotal<0) goodTotal=0; }
        else { badTotal -= def.points*curr; if(badTotal<0) badTotal=0; }
        clicks[def.id]=0;
        if(el && el._meta) el._meta.setVisual(0);
      }
    });
    document.getElementById('goodTotal').textContent = goodTotal;
    document.getElementById('badTotal').textContent = badTotal;
    saveClicks();
    updateAll();
  }

  // تشغيل
  window.onload=()=>{ renderReasons(); restoreFromStorage(); };
</script>
</body>
</html>
