<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ميزان أعمالي</title>
  <style>
    body {
      font-family: 'Tahoma';
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #2e7d32; }
    .container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .column {
      background-color: white;
      padding: 20px;
      width: 300px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .column h2 { margin-top: 0; }
    input, button, select {
      padding: 8px;
      margin: 5px;
      width: 80%;
    }
    ul {
      list-style-type: none;
      padding: 0;
      margin: 15px 0;
    }
    li {
      margin-bottom: 5px;
      background-color: #e0f2f1;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
    }
    .summary {
      margin-top: 30px;
      font-size: 1.2em;
      color: #333;
    }

    /* تذكير */
    .reminder-box {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      padding: 20px;
      margin: 40px auto 20px;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .reminder-box button {
      background-color: #ffc107;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
    }

    /* عداد القبر */
    .grave-meter-box {
      background-color: #fdecea;
      color: #611a15;
      border: 1px solid #f5c6cb;
      padding: 20px;
      margin: 30px auto;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .progress-container {
      background-color: #f8d7da;
      border-radius: 20px;
      overflow: hidden;
      height: 25px;
      margin: 10px 0;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #dc3545;
      transition: width 0.5s ease-in-out;
    }

    /* التخفيف */
    .mitigation-box{
      background:#e9f3ff; color:#0f3b79; border:1px solid #cfe3ff;
      padding:20px; margin:30px auto; width:80%;
      border-radius:10px; box-shadow:0 0 10px #ccc;
    }
    .mitigation-box h2{ margin-top:0 }
    .miti-buttons{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap }
    .miti-buttons button{
      padding:10px 14px; border:none; border-radius:8px; background:#1976d2; color:#fff; cursor:pointer;
    }
    .miti-note{ margin-top:8px; font-size:.95em }

    /* الإنفوجرافيك (أسباب الجنة والنار) */
    .infobox{
      background:#ffffff;border:1px solid #eaeaea;color:#1b1b1b;
      padding:20px;margin:30px auto;width:80%;
      border-radius:10px;box-shadow:0 0 10px #ccc;text-align:center;
    }
    .infobox h2{margin:0 0 12px}
    .infogrid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
      gap:16px;justify-items:center;align-items:center;margin-top:10px;
    }

    /* بطاقة السبب بدائرة SVG */
    .reason{
      width:120px;height:140px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;user-select:none
    }
    .ringwrap{position:relative;width:120px;height:120px}
    .ringwrap .inner{
      position:absolute;inset:28px;border-radius:50%;background:#fff;
      display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:6px;text-align:center;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .inner .icon{font-size:24px;line-height:1}
    .inner .label{font-size:12px;color:#333}
    .inner .times{font-size:11px;color:#666}

    .count{
      position:absolute;bottom:-6px;right:-6px;background:#2e7d32;color:#fff;
      font-size:11px;border-radius:12px;padding:2px 6px;box-shadow:0 2px 6px rgba(0,0,0,.15)
    }
    .bad .count{background:#dc3545}

    /* SVG: سماكة 30 + تدرّج + لمعة */
    .svg{transform:rotate(-90deg)}
    .track{stroke:#e5e5e5;stroke-width:30;fill:none}
    .prog-good{stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(46,125,50,.6))}
    .prog-bad {stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(220,53,69,.6))}

    /* الجزاء النهائي */
    .final-judgment-box {
      background-color: #e8f5e9;
      color: #1b5e20;
      border: 1px solid #c8e6c9;
      padding: 20px;
      margin: 30px auto;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .judgment-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      gap: 30px;
    }
    .judgment-column { width: 100px; text-align: center; }
    .judgment-meter {
      width: 40px; height: 200px; background-color: #ddd;
      border-radius: 20px; position: relative; overflow: hidden;
    }
    #judgmentIndicator {
      position: absolute; width: 100%; height: 0%; bottom: 0;
      background: linear-gradient(to top, #dc3545, #ffc107, #4caf50);
      transition: height 0.5s ease-in-out;
    }
  </style>
</head>
<body>
  <h1>📖 ميزان أعمالي</h1>

  <div class="container">
    <div class="column" id="good">
      <h2>✅ الحسنات</h2>
      <input type="text" id="goodDesc" placeholder="وصف العمل" />
      <input type="number" id="goodPoints" placeholder="الدرجة" />
      <ul id="goodList"></ul>
      <strong>المجموع: <span id="goodTotal">0</span></strong>
    </div>

    <div class="column" id="bad">
      <h2>❌ السيئات</h2>
      <input type="text" id="badDesc" placeholder="وصف العمل" />
      <input type="number" id="badPoints" placeholder="الدرجة" />
      <ul id="badList"></ul>
      <strong>المجموع: <span id="badTotal">0</span></strong>
    </div>
  </div>

  <div class="summary">
    ⚖️ الفارق = <span id="netResult">0</span> نقطة
  </div>

  <!-- تذكير -->
  <div class="reminder-box">
    <h2>☠️ عذاب القبر – تذكير وتحذير</h2>
    <p id="reminderText">اضغط على الزر لتتذكر الآخرة...</p>
    <button onclick="showReminder()">ذكرني اليوم</button>
  </div>

  <!-- عداد القبر -->
  <div class="grave-meter-box">
    <h2>📉 عداد عذاب القبر</h2>
    <div class="progress-container">
      <div id="graveProgress" class="progress-bar"></div>
    </div>
    <p id="graveLevel">المستوى: آمن</p>
  </div>

  <!-- التخفيف -->
  <div class="mitigation-box">
    <h2>🛡️ التخفيف من عذاب القبر</h2>
    <div class="miti-buttons">
      <button onclick="applyMitigation('tawba')">توبة نصوح</button>
      <button onclick="applyMitigation('surahMulk')">سورة الملك ليلاً</button>
      <button onclick="applyMitigation('repayDebt')">سداد دين/رد مظلمة</button>
      <button onclick="applyMitigation('cutNamimah')">قطع النميمة</button>
    </div>
    <div id="mitigationNote" class="miti-note">كل خيار متاح مرة كل 24 ساعة.</div>
  </div>

  <!-- الإنفوجرافيك: أسباب الجنة والنار -->
  <div class="infobox" id="reasonsBox">
    <h2>🧭 أسباب دخول الجنة والنار</h2>
    <div class="infogrid" id="reasonsGrid"></div>
    <div style="margin-top:8px;font-size:13px;color:#666">
      اضغط على السبب لزيادة الأثر (حلقة دائرية). كل ضغطة تضيف نقاطها تلقائيًا.
    </div>
  </div>

  <!-- الجزاء النهائي -->
  <div class="final-judgment-box">
    <h2>🌌 الجزاء النهائي</h2>
    <div class="judgment-container">
      <div class="judgment-column"><h3>🌴 الجنة</h3></div>
      <div class="judgment-meter"><div id="judgmentIndicator"></div></div>
      <div class="judgment-column"><h3>🔥 النار</h3></div>
    </div>
    <p id="judgmentResult">⬅️ يتم حساب المصير تلقائيًا حسب أعمالك...</p>
  </div>

  <script>
    let goodTotal = 0;
    let badTotal  = 0;

    /* معاملات التخفيف */
    const K_GOOD = 0.6; // وزن تأثير الحسنات
    const MITIGATION_POINTS = { tawba:25, surahMulk:10, repayDebt:35, cutNamimah:20 };
    let mitigationTotal = 0;

    function addEntry(type) {
      const desc = document.getElementById(`${type}Desc`).value;
      const points = parseInt(document.getElementById(`${type}Points`).value);
      if (!desc || isNaN(points)) return;

      const list = document.getElementById(`${type}List`);
      const li = document.createElement('li');
      li.textContent = `${desc} (${points} نقطة)`;
      li.onclick = () => {
        list.removeChild(li);
        if (type === 'good') {
          goodTotal -= points;
          document.getElementById('goodTotal').textContent = goodTotal;
        } else {
          badTotal -= points;
          document.getElementById('badTotal').textContent = badTotal;
        }
        updateAll();
      };
      list.appendChild(li);

      if (type === 'good') {
        goodTotal += points;
        document.getElementById('goodTotal').textContent = goodTotal;
      } else {
        badTotal += points;
        document.getElementById('badTotal').textContent = badTotal;
      }

      document.getElementById(`${type}Desc`).value = '';
      document.getElementById(`${type}Points`).value = '';
      updateAll();
    }

    function updateAll() {
      updateNetResult();
      updateGraveMeter();
      autoUpdateFinalJudgment();
    }

    function updateNetResult() {
      const net = goodTotal - badTotal;
      document.getElementById('netResult').textContent = net;
    }

    function showReminder() {
      const reminders = [
        "كان عثمان بن عفان إذا ذُكر القبر بكى حتى تبتل لحيته.",
        "القبر أول منازل الآخرة، فإن نجا منه فما بعده أيسر.",
        "أكثروا من ذكر هادم اللذات: الموت.",
        "اللهم قِنا عذاب القبر، وثبّتنا عند السؤال.",
        "استعدوا للقبر، فإن الليل والنهار يعملان فيكم."
      ];
      const text = reminders[Math.floor(Math.random() * reminders.length)];
      document.getElementById('reminderText').textContent = text;
    }

    /* التخفيف: مرة كل 24 ساعة لكل خيار */
    function canUseMitigation(key){
      const t = localStorage.getItem('miti_'+key);
      if(!t) return true;
      const hrs = (Date.now()-parseInt(t,10))/(1000*60*60);
      return hrs >= 24;
    }
    function markMitigationUsed(key){
      localStorage.setItem('miti_'+key, Date.now().toString());
    }
    function applyMitigation(key){
      const note = document.getElementById('mitigationNote');
      if(!MITIGATION_POINTS[key]) return;
      if(!canUseMitigation(key)){
        note.textContent = "⏳ هذا الخيار استُخدم خلال آخر 24 ساعة.";
        return;
      }
      mitigationTotal += MITIGATION_POINTS[key];
      markMitigationUsed(key);
      note.textContent = "✅ تم تطبيق إجراء التخفيف. اثبت على الطاعة واترك أسباب الخطر.";
      updateAll();
    }

    /* حساب خطر القبر (0..100) مع التخفيف */
    function computeGraveRisk(){
      let risk = badTotal - K_GOOD*goodTotal - mitigationTotal;
      if(risk < 0) risk = 0;
      if(risk > 100) risk = 100;
      return Math.round(risk);
    }

    function updateGraveMeter() {
      const levelText = document.getElementById("graveLevel");
      const progressBar = document.getElementById("graveProgress");
      const risk = computeGraveRisk(); // 0..100

      progressBar.style.width = risk + "%";

      let label = "آمن";
      if (risk > 10 && risk <= 30) label = "تحذير بسيط";
      else if (risk > 30 && risk <= 60) label = "خطر متوسط ⚠️";
      else if (risk > 60 && risk < 90) label = "اقتراب من العذاب 😟";
      else if (risk >= 90) label = "🔥 شديد الخطر – تب قبل فوات الأوان";

      levelText.textContent = "المستوى: " + label;
    }

    function autoUpdateFinalJudgment() {
      const result = document.getElementById("judgmentResult");
      const indicator = document.getElementById("judgmentIndicator");
      const net = goodTotal - badTotal;
      let heightPercent = 50;

      if (net > 100) { result.textContent = "🥇 أعمالك عظيمة، وجهتك الجنة بإذن الله!"; heightPercent = 100; }
      else if (net > 50) { result.textContent = "🌿 مصيرك الجنة إن شاء الله، واصل الثبات."; heightPercent = 80; }
      else if (net > 0) { result.textContent = "🤲 على الطريق، واصل العمل الصالح."; heightPercent = 65; }
      else if (net === 0) { result.textContent = "⚖️ تعادل الحساب، فكن من المستغفرين."; heightPercent = 50; }
      else if (net > -30) { result.textContent = "❗ خطر! راجع نفسك قبل فوات الأوان."; heightPercent = 35; }
      else if (net > -70) { result.textContent = "🔥 تسارع نحو الخطر، بادر بالتوبة."; heightPercent = 20; }
      else { result.textContent = "🚫 مصيرك النار إن لم تتب، اللهم سلم!"; heightPercent = 5; }

      indicator.style.height = heightPercent + "%";
    }

    /* القوائم الجاهزة (كما في تصميمك) */
    const goodActions = [
      { text: "صلاة الفجر في وقتها", points: 20 },
      { text: "الصدقة على محتاج", points: 15 },
      { text: "قراءة القرآن", points: 10 },
      { text: "بر الوالدين", points: 25 },
      { text: "الابتسامة في وجه أخيك", points: 5 },
      { text: "الاستغفار 100 مرة", points: 12 },
      { text: "قيام الليل", points: 18 }
    ];
    const badActions = [
      { text: "الكذب", points: 10 },
      { text: "النميمة", points: 15 },
      { text: "ترك الصلاة", points: 25 },
      { text: "إيذاء الآخرين", points: 12 },
      { text: "سماع الحرام", points: 8 },
      { text: "نظر محرم", points: 7 },
      { text: "الغيبة", points: 15 }
    ];

    function populateDropdowns() {
      const goodSelect = document.createElement("select");
      goodSelect.id = "goodSelect";
      goodSelect.innerHTML = '<option value="">اختر عملًا حسنًا</option>';
      goodActions.forEach(action => {
        const option = document.createElement("option");
        option.value = action.points;
        option.textContent = `${action.text} (+${action.points})`;
        goodSelect.appendChild(option);
      });
      const goodBtn = document.createElement("button");
      goodBtn.textContent = "إضافة";
      goodBtn.onclick = () => {
        const selected = goodSelect.options[goodSelect.selectedIndex];
        if (selected.value) {
          document.getElementById("goodDesc").value = selected.textContent;
          document.getElementById("goodPoints").value = selected.value;
          addEntry('good');
        }
      };

      const badSelect = document.createElement("select");
      badSelect.id = "badSelect";
      badSelect.innerHTML = '<option value="">اختر عملًا سيئًا</option>';
      badActions.forEach(action => {
        const option = document.createElement("option");
        option.value = action.points;
        option.textContent = `${action.text} (-${action.points})`;
        badSelect.appendChild(option);
      });
      const badBtn = document.createElement("button");
      badBtn.textContent = "إضافة";
      badBtn.onclick = () => {
        const selected = badSelect.options[badSelect.selectedIndex];
        if (selected.value) {
          document.getElementById("badDesc").value = selected.textContent;
          document.getElementById("badPoints").value = selected.value;
          addEntry('bad');
        }
      };

      document.getElementById("good").appendChild(goodSelect);
      document.getElementById("good").appendChild(goodBtn);
      document.getElementById("bad").appendChild(badSelect);
      document.getElementById("bad").appendChild(badBtn);
    }

    /* ==== إنفوجرافيك الأسباب — SVG بسماكة 30 + Gradient + Glow ==== */
    const REASONS = [
      // أسباب الجنة
      { id:'iman',     type:'good', icon:'🕋', label:'الإيمان',        points:25 },
      { id:'salah',    type:'good', icon:'🕌', label:'الصلاة',          points:20 },
      { id:'birr',     type:'good', icon:'👨‍👩‍👧‍👦', label:'برّ الوالدين', points:18 },
      { id:'sadaqa',   type:'good', icon:'🤝', label:'الصدقة',          points:15 },
      { id:'siyam',    type:'good', icon:'🌙', label:'الصوم',           points:12 },
      { id:'silah',    type:'good', icon:'🧬', label:'صلة الرحم',       points:12 },
      // أسباب النار
      { id:'kufr',     type:'bad',  icon:'🚫', label:'الكفر/الشرك',     points:40 },
      { id:'tarkSalah',type:'bad',  icon:'⛔️', label:'ترك الصلاة',      points:30 },
      { id:'uquq',     type:'bad',  icon:'💢', label:'عقوق الوالدين',   points:25 },
      { id:'zina',     type:'bad',  icon:'⚠️', label:'الزنا',           points:35 },
      { id:'riba',     type:'bad',  icon:'💸', label:'الربا',           points:25 },
      { id:'namimahR', type:'bad',  icon:'🗣️', label:'النميمة',        points:15 }
    ];
    const reasonClicks = {}; REASONS.forEach(r=>reasonClicks[r.id]=0);

    function gradientStops(type){
      return type==='bad' ? ['#dc3545','#ff7043'] : ['#2e7d32','#66bb6a'];
    }

    function createReason(r){
      const grid = document.getElementById('reasonsGrid');
      const wrap = document.createElement('div');
      wrap.className = 'reason ' + (r.type==='bad'?'bad':'good');
      wrap.id = 'reason_'+r.id;

      const ringwrap = document.createElement('div'); ringwrap.className='ringwrap';

      // SVG إعداد
      const size=120, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
      const gradId=`grad_${r.type}_${r.id}`;
      const [c1,c2]=gradientStops(r.type);

      ringwrap.innerHTML = `
        <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <defs>
            <linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%"  stop-color="${c1}"></stop>
              <stop offset="100%" stop-color="${c2}"></stop>
            </linearGradient>
          </defs>
          <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
          <circle class="${r.type==='bad'?'prog-bad':'prog-good'}"
                  id="prog_${r.id}"
                  cx="${cx}" cy="${cy}" r="${r0}"
                  stroke="url(#${gradId})"
                  stroke-linecap="round"
                  stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
        </svg>
      `;

      const inner = document.createElement('div'); inner.className='inner';
      inner.innerHTML = `
        <div class="icon">${r.icon}</div>
        <div class="label">${r.label}</div>
        <div class="times"><span id="t_${r.id}">0</span>×</div>
      `;

      const badge = document.createElement('div'); badge.className='count'; badge.textContent='0×';

      ringwrap.appendChild(inner);
      ringwrap.appendChild(badge);
      wrap.appendChild(ringwrap);

      wrap.onclick = ()=> onReasonClick(r.id, C);

      grid.appendChild(wrap);
    }

    function updateReasonVisual(id, C){
      const c = reasonClicks[id];
      const prog = document.getElementById('prog_'+id);
      if(!prog) return;
      const maxClicks = 5; // نفس منطقك السابق: كل ضغطة 20% (5 ضغطات = 100%)
      const pct = Math.min(1, c / maxClicks);
      const offset = C * (1 - pct);
      prog.style.strokeDashoffset = offset;

      const t = document.getElementById('t_'+id);
      if(t) t.textContent = c;
      const card = document.getElementById('reason_'+id);
      if(card){ const b = card.querySelector('.count'); if(b) b.textContent = c+'×'; }
    }

    function onReasonClick(id, C){
      const def = REASONS.find(x=>x.id===id);
      if(!def) return;

      reasonClicks[id] = (reasonClicks[id]||0) + 1;
      if(def.type==='good'){ goodTotal += def.points; document.getElementById('goodTotal').textContent = goodTotal; }
      else { badTotal += def.points; document.getElementById('badTotal').textContent = badTotal; }

      updateReasonVisual(id, C);
      updateAll();
    }

    function renderReasons(){
      REASONS.forEach(def=>createReason(def));
      // بعد الإنشاء الأولى: اضبط المؤشرات على 0
      REASONS.forEach(def=>{
        const size=120, r0=36, C=2*Math.PI*r0;
        updateReasonVisual(def.id, C);
      });
    }

    /* تشغيل */
    window.onload = () => {
      populateDropdowns();
      renderReasons();
      updateAll();
    };
  </script>
</body>
</html>
