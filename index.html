<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ÙŠØ²Ø§Ù† Ø£Ø¹Ù…Ø§Ù„ÙŠ</title>
  <style>
    body{font-family:Tahoma,Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;text-align:center}
    h1{color:#2e7d32}

    .container{display:flex;justify-content:center;gap:40px;margin-top:30px;flex-wrap:wrap}
    .column{background:#fff;padding:20px;width:300px;border-radius:10px;box-shadow:0 0 10px #ccc}
    .column h2{margin-top:0}
    input,button,select{padding:8px;margin:5px;width:80%}
    ul{list-style:none;padding:0;margin:15px 0}
    li{margin-bottom:5px;background:#e0f2f1;padding:8px;border-radius:5px;cursor:pointer}
    .summary{margin-top:30px;font-size:1.2em;color:#333}

    /* ØªØ°ÙƒÙŠØ± */
    .reminder-box{background:#fff3cd;color:#856404;border:1px solid #ffeeba;padding:20px;margin:40px auto 20px;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .reminder-box button{background:#ffc107;border:none;padding:10px 20px;font-size:1em;border-radius:5px;cursor:pointer}

    /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø¨Ø± + Ø§Ù„ØªØ®ÙÙŠÙ */
    .grave-meter-box{background:#fdecea;color:#611a15;border:1px solid #f5c6cb;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .progress-container{background:#f8d7da;border-radius:20px;overflow:hidden;height:25px;margin:10px 0}
    .progress-bar{height:100%;width:0%;background:#dc3545;transition:width .5s}
    .mitigation-box{background:#e9f3ff;color:#0f3b79;border:1px solid #cfe3ff;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .miti-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .miti-buttons button{padding:10px 14px;border:none;border-radius:8px;background:#1976d2;color:#fff;cursor:pointer}
    .miti-note{margin-top:8px;font-size:.95em}

    /* --- ÙƒØ±Ø§Ù…Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© --- */
    .day-honors,.day-warnings,.day-scenes{background:#fff;border:1px solid #eaeaea;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .day-honors h2,.day-warnings h2,.day-scenes h2{margin:0 0 8px}
    .honors-grid,.warnings-grid,.scenes-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:18px;justify-items:center}
    .honor-card,.warn-card,.scene-card{width:160px;display:flex;flex-direction:column;align-items:center;gap:8px}
    .ringwrap{position:relative;width:140px;height:140px}
    .inner{position:absolute;inset:28px;border-radius:50%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .inner .icon{font-size:26px}
    .inner .title{font-size:14px;color:#222}
    .inner .meta{font-size:12px;color:#666}
    .help{position:absolute;top:-6px;left:-6px;background:#00000080;color:#fff;width:20px;height:20px;border-radius:50%;display:grid;place-items:center;font-size:12px;cursor:pointer}
    .count-badge{position:absolute;bottom:-6px;right:-6px;background:#2e7d32;color:#fff;font-size:12px;border-radius:12px;padding:2px 6px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    .count-badge.bad{background:#dc3545}
    .track{stroke:#e5e5e5;stroke-width:30;fill:none}
    .prog-good{stroke-width:30;fill:none;transition:stroke-dashoffset .35s;filter:drop-shadow(0 0 8px rgba(46,125,50,.6))}
    .prog-bad {stroke-width:30;fill:none;transition:stroke-dashoffset .35s;filter:drop-shadow(0 0 8px rgba(220,53,69,.6))}
    .prog-info{stroke-width:30;fill:none;transition:stroke-dashoffset .35s;filter:drop-shadow(0 0 8px rgba(33,150,243,.6))}
    .svg{transform:rotate(-90deg)}

    /* Ø¥Ù†ÙÙˆØ¬Ø±Ø§ÙÙŠÙƒ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ (Ù‚Ø³Ù…Ø§Ù†) */
    .infobox{background:#fff;border:1px solid #eaeaea;color:#1b1b1b;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .two-cols{display:grid;grid-template-areas:"good bad";gap:20px}
    .sec-good{grid-area:good}
    .sec-bad{grid-area:bad}
    @media(max-width:820px){.two-cols{grid-template-areas:"good" "bad"}}
    .infosec{border:1px dashed #ebebeb;border-radius:10px;padding:12px}
    .infosec h3{margin:0 0 10px}
    .infogrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px;justify-items:center}

    /* Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ (Ø¹Ø±Ø¶ 30 + ØªØ¯Ø±Ø¬ + Ù„Ù…Ø¹Ø©) */
    .reason{width:140px;height:170px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;user-select:none}
    .ringwrap .reason-inner{position:absolute;inset:28px;border-radius:50%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .reason .icon{font-size:30px;line-height:1}
    .reason .title{font-size:14px;color:#222}
    .reason .times{font-size:12px;color:#666}
    .count{position:absolute;bottom:-8px;right:-8px;background:#2e7d32;color:#fff;font-size:12px;border-radius:14px;padding:3px 8px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    .bad .count{background:#dc3545}
    .track-r{stroke:#e5e5e5;stroke-width:30;fill:none}
    .prog-good-r{stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(46,125,50,.6))}
    .prog-bad-r {stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(220,53,69,.6))}
    .svg-r{transform:rotate(-90deg)}

    /* Ø§Ù„Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */
    .final-judgment-box{background:#e8f5e9;color:#1b5e20;border:1px solid #c8e6c9;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .judgment-container{display:flex;justify-content:center;align-items:center;margin:20px 0;gap:30px}
    .judgment-column{width:100px;text-align:center}
    .judgment-meter{width:40px;height:200px;background:#ddd;border-radius:20px;position:relative;overflow:hidden}
    #judgmentIndicator{position:absolute;width:100%;height:0%;bottom:0;background:linear-gradient(to top,#dc3545,#ffc107,#4caf50);transition:height .45s}
  </style>
</head>
<body>
  <h1>ğŸ“– Ù…ÙŠØ²Ø§Ù† Ø£Ø¹Ù…Ø§Ù„ÙŠ</h1>

  <!-- Ø§Ù„Ø­Ø³Ù†Ø§Øª / Ø§Ù„Ø³ÙŠØ¦Ø§Øª -->
  <div class="container">
    <div class="column" id="good">
      <h2>âœ… Ø§Ù„Ø­Ø³Ù†Ø§Øª</h2>
      <input type="text" id="goodDesc" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„" />
      <input type="number" id="goodPoints" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø©" />
      <ul id="goodList"></ul>
      <strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="goodTotal">0</span></strong>
    </div>
    <div class="column" id="bad">
      <h2>âŒ Ø§Ù„Ø³ÙŠØ¦Ø§Øª</h2>
      <input type="text" id="badDesc" placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù…Ù„" />
      <input type="number" id="badPoints" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø©" />
      <ul id="badList"></ul>
      <strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="badTotal">0</span></strong>
    </div>
  </div>

  <div class="summary">âš–ï¸ Ø§Ù„ÙØ§Ø±Ù‚ = <span id="netResult">0</span> Ù†Ù‚Ø·Ø©</div>

  <!-- ØªØ°ÙƒÙŠØ± -->
  <div class="reminder-box">
    <h2>â˜ ï¸ Ø¹Ø°Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ø± â€“ ØªØ°ÙƒÙŠØ± ÙˆØªØ­Ø°ÙŠØ±</h2>
    <p id="reminderText">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„ØªØªØ°ÙƒØ± Ø§Ù„Ø¢Ø®Ø±Ø©...</p>
    <button onclick="showReminder()">Ø°ÙƒØ±Ù†ÙŠ Ø§Ù„ÙŠÙˆÙ…</button>
  </div>

  <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø¨Ø± -->
  <div class="grave-meter-box">
    <h2>ğŸ“‰ Ø¹Ø¯Ø§Ø¯ Ø¹Ø°Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ø±</h2>
    <div class="progress-container"><div id="graveProgress" class="progress-bar"></div></div>
    <p id="graveLevel">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ø¢Ù…Ù†</p>
  </div>

  <!-- Ø§Ù„ØªØ®ÙÙŠÙ -->
  <div class="mitigation-box">
    <h2>ğŸ›¡ï¸ Ø§Ù„ØªØ®ÙÙŠÙ Ù…Ù† Ø¹Ø°Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ø±</h2>
    <div class="miti-buttons">
      <button onclick="applyMitigation('tawba')">ØªÙˆØ¨Ø© Ù†ØµÙˆØ­</button>
      <button onclick="applyMitigation('surahMulk')">Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ù„Ùƒ Ù„ÙŠÙ„Ø§Ù‹</button>
      <button onclick="applyMitigation('repayDebt')">Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ†/Ø±Ø¯ Ù…Ø¸Ù„Ù…Ø©</button>
      <button onclick="applyMitigation('cutNamimah')">Ù‚Ø·Ø¹ Ø§Ù„Ù†Ù…ÙŠÙ…Ø©</button>
    </div>
    <div id="mitigationNote" class="miti-note">ÙƒÙ„ Ø®ÙŠØ§Ø± Ù…ØªØ§Ø­ Ù…Ø±Ø© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©.</div>
  </div>

  <!-- ğŸ•Šï¸ ÙƒØ±Ø§Ù…Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© -->
  <div class="day-honors" id="honorsBox">
    <h2>ğŸ•Šï¸ ÙƒØ±Ø§Ù…Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø©</h2>
    <p style="color:#555;margin:6px 0 16px">ØªÙ…Ø«ÙŠÙ„ Ø±Ù…Ø²ÙŠ Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ù„Ù„ØªØ°ÙƒÙŠØ± ÙˆØ§Ù„ØªØ­ÙÙŠØ²).</p>
    <div class="honors-grid" id="honorsGrid"></div>
  </div>

  <!-- â— Ø¥Ù‡Ø§Ù†Ø§Øª ÙˆØ¹Ù‚ÙˆØ¨Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© -->
  <div class="day-warnings" id="warningsBox">
    <h2>â— Ø¥Ù‡Ø§Ù†Ø§Øª ÙˆØ¹Ù‚ÙˆØ¨Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø©</h2>
    <p style="color:#555;margin:6px 0 16px">Ù…Ø¤Ø´Ø±Ø§Øª ØªØ­Ø°ÙŠØ±ÙŠØ© Ø±Ù…Ø²ÙŠØ© ØªÙ‚Ù„Ù‘ Ø¨Ø§Ù„ØªÙˆØ¨Ø© ÙˆØªØ±Ùƒ Ø£Ø³Ø¨Ø§Ø¨Ù‡Ø§.</p>
    <div class="warnings-grid" id="warningsGrid"></div>
  </div>

  <!-- ğŸŒ Ù…Ø´Ø§Ù‡Ø¯ ÙˆØ£Ø­Ø¯Ø§Ø« Ø¹Ø§Ù…Ø© ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© -->
  <div class="day-scenes" id="scenesBox">
    <h2>ğŸŒ Ù…Ø´Ø§Ù‡Ø¯ ÙˆØ£Ø­Ø¯Ø§Ø« Ø¹Ø§Ù…Ø© ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø©</h2>
    <p style="color:#555;margin:6px 0 16px">Ø¹Ø±Ø¶ ØªÙˆØ¹ÙˆÙŠ Ù„Ø£Ø­ÙˆØ§Ù„ Ø¹Ø§Ù…Ø© (Ù…Ø«Ù„ Ø§Ù„Ø¹Ø±Ù‚ Ø¹Ù„Ù‰ Ù‚Ø¯Ø± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„).</p>
    <div class="scenes-grid" id="scenesGrid"></div>
  </div>

  <!-- Ø¥Ù†ÙÙˆØ¬Ø±Ø§ÙÙŠÙƒ: Ø§Ù„Ø¬Ù†Ø© ÙˆØ§Ù„Ù†Ø§Ø± -->
  <div class="infobox">
    <h2>ğŸ§­ Ø£Ø³Ø¨Ø§Ø¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ù†Ø© ÙˆØ§Ù„Ù†Ø§Ø±</h2>
    <div class="two-cols">
      <div class="infosec sec-good">
        <h3>ğŸŒ´ Ø£Ø³Ø¨Ø§Ø¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ù†Ø©</h3>
        <div class="infogrid" id="reasonsGoodGrid"></div>
      </div>
      <div class="infosec sec-bad">
        <h3>ğŸ”¥ Ø£Ø³Ø¨Ø§Ø¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø§Ø±</h3>
        <div class="infogrid" id="reasonsBadGrid"></div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
  <div class="final-judgment-box">
    <h2>ğŸŒŒ Ø§Ù„Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
    <div class="judgment-container">
      <div class="judgment-column"><h3>ğŸŒ´ Ø§Ù„Ø¬Ù†Ø©</h3></div>
      <div class="judgment-meter"><div id="judgmentIndicator"></div></div>
      <div class="judgment-column"><h3>ğŸ”¥ Ø§Ù„Ù†Ø§Ø±</h3></div>
    </div>
    <p id="judgmentResult">â¬…ï¸ ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØµÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø£Ø¹Ù…Ø§Ù„Ùƒ...</p>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­ -->
  <div class="modal" id="modal"><div class="card">
    <header id="modalTitle">Ø´Ø±Ø­</header>
    <div class="content" id="modalBody"></div>
    <footer><button onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button></footer>
  </div></div>

<script>
  /* =============== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø¹Ø§Ù…Ø© =============== */
  let goodTotal=0, badTotal=0;
  const K_GOOD=0.6;
  const MITIGATION_POINTS={tawba:25,surahMulk:10,repayDebt:35,cutNamimah:20};
  let mitigationTotal=0;

  function addEntry(type){
    const desc=document.getElementById(`${type}Desc`).value.trim();
    const points=parseInt(document.getElementById(`${type}Points`).value);
    if(!desc||isNaN(points))return;
    const list=document.getElementById(`${type}List`);
    const li=document.createElement('li');
    li.textContent=`${desc} (${points} Ù†Ù‚Ø·Ø©)`;
    li.onclick=()=>{list.removeChild(li); if(type==='good'){goodTotal-=points;} else {badTotal-=points;} applyKeywordPoints(desc,-points,type); refreshUI();};
    list.appendChild(li);
    if(type==='good'){goodTotal+=points;} else {badTotal+=points;}
    applyKeywordPoints(desc,points,type);
    document.getElementById('goodTotal').textContent=goodTotal;
    document.getElementById('badTotal').textContent=badTotal;
    document.getElementById(`${type}Desc`).value=''; document.getElementById(`${type}Points`).value='';
    refreshUI();
  }

  function updateNetResult(){document.getElementById('netResult').textContent=goodTotal-badTotal;}

  function showReminder(){
    const reminders=["ÙƒØ§Ù† Ø¹Ø«Ù…Ø§Ù† Ø¨Ù† Ø¹ÙØ§Ù† Ø¥Ø°Ø§ Ø°ÙÙƒØ± Ø§Ù„Ù‚Ø¨Ø± Ø¨ÙƒÙ‰ Ø­ØªÙ‰ ØªØ¨ØªÙ„ Ù„Ø­ÙŠØªÙ‡.","Ø§Ù„Ù‚Ø¨Ø± Ø£ÙˆÙ„ Ù…Ù†Ø§Ø²Ù„ Ø§Ù„Ø¢Ø®Ø±Ø©ØŒ ÙØ¥Ù† Ù†Ø¬Ø§ Ù…Ù†Ù‡ ÙÙ…Ø§ Ø¨Ø¹Ø¯Ù‡ Ø£ÙŠØ³Ø±.","Ø£ÙƒØ«Ø±ÙˆØ§ Ù…Ù† Ø°ÙƒØ± Ù‡Ø§Ø¯Ù… Ø§Ù„Ù„Ø°Ø§Øª: Ø§Ù„Ù…ÙˆØª.","Ø§Ù„Ù„Ù‡Ù… Ù‚ÙÙ†Ø§ Ø¹Ø°Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ø±ØŒ ÙˆØ«Ø¨Ù‘ØªÙ†Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„.","Ø§Ø³ØªØ¹Ø¯ÙˆØ§ Ù„Ù„Ù‚Ø¨Ø±ØŒ ÙØ¥Ù† Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø± ÙŠØ¹Ù…Ù„Ø§Ù† ÙÙŠÙƒÙ…."];
    document.getElementById('reminderText').textContent=reminders[Math.floor(Math.random()*reminders.length)];
  }

  function canUseMitigation(k){const t=localStorage.getItem('miti_'+k); if(!t) return true; return ((Date.now()-parseInt(t,10))/(1000*60*60))>=24;}
  function markMitigationUsed(k){localStorage.setItem('miti_'+k,Date.now().toString());}
  function applyMitigation(k){
    const note=document.getElementById('mitigationNote');
    if(!MITIGATION_POINTS[k])return;
    if(!canUseMitigation(k)){note.textContent="â³ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ø³ØªÙØ®Ø¯Ù… Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©.";return;}
    mitigationTotal+=MITIGATION_POINTS[k]; markMitigationUsed(k);
    note.textContent="âœ… ØªÙ… Ø§Ù„ØªØ®ÙÙŠÙ. Ø§Ø«Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¹Ø©."; refreshUI();
  }

  function computeGraveRisk(){
    let risk=badTotal - K_GOOD*goodTotal - mitigationTotal;
    if(risk<0)risk=0; if(risk>100)risk=100; return Math.round(risk);
  }
  function updateGraveMeter(){
    const risk=computeGraveRisk();
    document.getElementById('graveProgress').style.width=risk+'%';
    let label="Ø¢Ù…Ù†";
    if(risk>10&&risk<=30)label="ØªØ­Ø°ÙŠØ± Ø¨Ø³ÙŠØ·";
    else if(risk>30&&risk<=60)label="Ø®Ø·Ø± Ù…ØªÙˆØ³Ø· âš ï¸";
    else if(risk>60&&risk<90)label="Ø§Ù‚ØªØ±Ø§Ø¨ Ù…Ù† Ø§Ù„Ø¹Ø°Ø§Ø¨ ğŸ˜Ÿ";
    else if(risk>=90)label="ğŸ”¥ Ø´Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø·Ø± â€“ ØªØ¨ Ù‚Ø¨Ù„ ÙÙˆØ§Øª Ø§Ù„Ø£ÙˆØ§Ù†";
    document.getElementById('graveLevel').textContent='Ø§Ù„Ù…Ø³ØªÙˆÙ‰: '+label;
  }
  function autoUpdateFinalJudgment(){
    const net=goodTotal-badTotal;
    let h=50, txt="âš–ï¸ ØªØ¹Ø§Ø¯Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ ÙÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø³ØªØºÙØ±ÙŠÙ†.";
    if(net>100){h=100;txt="ğŸ¥‡ Ø£Ø¹Ù…Ø§Ù„Ùƒ Ø¹Ø¸ÙŠÙ…Ø©ØŒ ÙˆØ¬Ù‡ØªÙƒ Ø§Ù„Ø¬Ù†Ø© Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡!";}
    else if(net>50){h=80;txt="ğŸŒ¿ Ù…ØµÙŠØ±Ùƒ Ø§Ù„Ø¬Ù†Ø© Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ØŒ ÙˆØ§ØµÙ„ Ø§Ù„Ø«Ø¨Ø§Øª.";}
    else if(net>0){h=65;txt="ğŸ¤² Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ØŒ ÙˆØ§ØµÙ„ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­.";}
    else if(net===0){h=50;txt="âš–ï¸ ØªØ¹Ø§Ø¯Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ ÙÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø³ØªØºÙØ±ÙŠÙ†.";}
    else if(net>-30){h=35;txt="â— Ø®Ø·Ø±! Ø±Ø§Ø¬Ø¹ Ù†ÙØ³Ùƒ Ù‚Ø¨Ù„ ÙÙˆØ§Øª Ø§Ù„Ø£ÙˆØ§Ù†.";}
    else if(net>-70){h=20;txt="ğŸ”¥ ØªØ³Ø§Ø±Ø¹ Ù†Ø­Ùˆ Ø§Ù„Ø®Ø·Ø±ØŒ Ø¨Ø§Ø¯Ø± Ø¨Ø§Ù„ØªÙˆØ¨Ø©.";}
    else {h=5;txt="ğŸš« Ù…ØµÙŠØ±Ùƒ Ø§Ù„Ù†Ø§Ø± Ø¥Ù† Ù„Ù… ØªØªØ¨ØŒ Ø§Ù„Ù„Ù‡Ù… Ø³Ù„Ù…!";}
    document.getElementById('judgmentIndicator').style.height=h+'%';
    document.getElementById('judgmentResult').textContent=txt;
  }

  /* =============== Ø¥Ù†ÙÙˆØ¬Ø±Ø§ÙÙŠÙƒ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ (SVG 30 + Ù„Ù…Ø¹Ø©) =============== */
  const MAX_CLICKS=20;
  const REASONS_GOOD=[
    {id:'iman',icon:'ğŸ•‹',label:'Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†',points:25},
    {id:'salah',icon:'ğŸ•Œ',label:'Ø§Ù„ØµÙ„Ø§Ø©',points:20},
    {id:'birr',icon:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',label:'Ø¨Ø±Ù‘ Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†',points:18},
    {id:'sadaqa',icon:'ğŸ¤',label:'Ø§Ù„ØµØ¯Ù‚Ø©',points:15},
    {id:'siyam',icon:'ğŸŒ™',label:'Ø§Ù„ØµÙˆÙ…',points:12},
    {id:'silah',icon:'ğŸ§¬',label:'ØµÙ„Ø© Ø§Ù„Ø±Ø­Ù…',points:12}
  ];
  const REASONS_BAD=[
    {id:'kufr',icon:'ğŸš«',label:'Ø§Ù„ÙƒÙØ±/Ø§Ù„Ø´Ø±Ùƒ',points:40},
    {id:'tarkSalah',icon:'â›”ï¸',label:'ØªØ±Ùƒ Ø§Ù„ØµÙ„Ø§Ø©',points:30},
    {id:'uquq',icon:'ğŸ’¢',label:'Ø¹Ù‚ÙˆÙ‚ Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†',points:25},
    {id:'zina',icon:'âš ï¸',label:'Ø§Ù„Ø²Ù†Ø§',points:35},
    {id:'riba',icon:'ğŸ’¸',label:'Ø§Ù„Ø±Ø¨Ø§',points:25},
    {id:'namimahR',icon:'ğŸ—£ï¸',label:'Ø§Ù„Ù†Ù…ÙŠÙ…Ø©',points:15}
  ];
  const clicks={};
  function gradientStops(type){
    if(type==='bad')   return ['#dc3545','#ff7043'];
    if(type==='info')  return ['#2196f3','#64b5f6'];
    return ['#2e7d32','#66bb6a'];
  }

  function createReasonEl(r,type,grid){
    clicks[r.id]=clicks[r.id]||0;
    const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
    const gradId=`grad_${type}_${r.id}`;
    const [c1,c2]=gradientStops(type);
    const wrap=document.createElement('div'); wrap.className='reason '+(type==='bad'?'bad':'good'); wrap.id='reason_'+r.id;
    const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';
    ringwrap.innerHTML=`
      <svg class="svg-r" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
        <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs>
        <circle class="track-r" cx="${cx}" cy="${cy}" r="${r0}"></circle>
        <circle class="${type==='bad'?'prog-bad-r':'prog-good-r'}" id="prog_${r.id}" cx="${cx}" cy="${cy}" r="${r0}"
          stroke="url(#${gradId})" stroke-linecap="round" stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
      </svg>`;
    const inner=document.createElement('div'); inner.className='reason-inner';
    inner.innerHTML=`<div class="icon">${r.icon}</div><div class="title">${r.label}</div><div class="times"><span id="t_${r.id}">0</span>Ã—</div>`;
    const count=document.createElement('div'); count.className='count'; count.textContent='0Ã—';
    ringwrap.appendChild(inner); ringwrap.appendChild(count); wrap.appendChild(ringwrap);

    wrap.onclick=()=>{
      if(clicks[r.id] >= MAX_CLICKS) return;
      clicks[r.id]++; const pct=clicks[r.id]/MAX_CLICKS; const offset=C*(1-pct);
      document.getElementById('prog_'+r.id).style.strokeDashoffset=offset;
      document.getElementById('t_'+r.id).textContent=clicks[r.id]; count.textContent=clicks[r.id]+'Ã—';
      if(type==='good'){ goodTotal+=r.points; } else { badTotal+=r.points; }
      document.getElementById('goodTotal').textContent=goodTotal; document.getElementById('badTotal').textContent=badTotal;
      bumpCategoryByReason(r);
      refreshUI();
    };

    grid.appendChild(wrap);
  }

  function renderReasons(){
    const gGrid=document.getElementById('reasonsGoodGrid');
    const bGrid=document.getElementById('reasonsBadGrid');
    REASONS_GOOD.forEach(r=>createReasonEl(r,'good',gGrid));
    REASONS_BAD.forEach(r=>createReasonEl(r,'bad',bGrid));
  }

  /* =============== Ù‚ÙˆØ§Ø¦Ù… Ø¬Ø§Ù‡Ø²Ø© =============== */
  const goodActions=[{text:"ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§",points:20},{text:"Ø§Ù„ØµØ¯Ù‚Ø© Ø¹Ù„Ù‰ Ù…Ø­ØªØ§Ø¬",points:15},{text:"Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†",points:10},{text:"Ø¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†",points:25},{text:"Ø§Ù„Ø§Ø¨ØªØ³Ø§Ù…Ø© ÙÙŠ ÙˆØ¬Ù‡ Ø£Ø®ÙŠÙƒ",points:5},{text:"Ø§Ù„Ø§Ø³ØªØºÙØ§Ø± 100 Ù…Ø±Ø©",points:12},{text:"Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„",points:18},{text:"Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º 100 Ù…Ø±Ø©",points:12}];
  const badActions=[{text:"Ø§Ù„ÙƒØ°Ø¨",points:10},{text:"Ø§Ù„Ù†Ù…ÙŠÙ…Ø©",points:15},{text:"ØªØ±Ùƒ Ø§Ù„ØµÙ„Ø§Ø©",points:25},{text:"Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†",points:12},{text:"Ø³Ù…Ø§Ø¹ Ø§Ù„Ø­Ø±Ø§Ù…",points:8},{text:"Ù†Ø¸Ø± Ù…Ø­Ø±Ù…",points:7},{text:"Ø§Ù„ØºÙŠØ¨Ø©",points:15}];

  function populateDropdowns(){
    const goodSelect=document.createElement("select"); goodSelect.id="goodSelect"; goodSelect.innerHTML='<option value="">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ù‹Ø§ Ø­Ø³Ù†Ù‹Ø§</option>';
    goodActions.forEach(a=>{const o=document.createElement("option"); o.value=a.points; o.textContent=`${a.text} (+${a.points})`; goodSelect.appendChild(o);});
    const goodBtn=document.createElement("button"); goodBtn.textContent="Ø¥Ø¶Ø§ÙØ©"; goodBtn.onclick=()=>{const s=goodSelect.options[goodSelect.selectedIndex]; if(s.value){document.getElementById("goodDesc").value=s.textContent; document.getElementById("goodPoints").value=s.value; addEntry('good');}};
    const badSelect=document.createElement("select"); badSelect.id="badSelect"; badSelect.innerHTML='<option value="">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ù‹Ø§ Ø³ÙŠØ¦Ù‹Ø§</option>';
    badActions.forEach(a=>{const o=document.createElement("option"); o.value=a.points; o.textContent=`${a.text} (-${a.points})`; badSelect.appendChild(o);});
    const badBtn=document.createElement("button"); badBtn.textContent="Ø¥Ø¶Ø§ÙØ©"; badBtn.onclick=()=>{const s=badSelect.options[badSelect.selectedIndex]; if(s.value){document.getElementById("badDesc").value=s.textContent; document.getElementById("badPoints").value=s.value; addEntry('bad');}};
    document.getElementById("good").appendChild(goodSelect); document.getElementById("good").appendChild(goodBtn);
    document.getElementById("bad").appendChild(badSelect); document.getElementById("bad").appendChild(badBtn);
  }

  /* =============== Ù…Ù‚Ø§ÙŠÙŠØ³ ØªÙØµÙŠÙ„ÙŠØ© Ù„ØªØºØ°ÙŠØ© Ø§Ù„ÙƒØ±Ø§Ù…Ø§Øª/Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ =============== */
  const Metrics={charity:0,quran:0,salah:0,iman:0,birr:0,siyam:0,silah:0,salawat:0,dhikr:0};
  function bumpCategoryByReason(r){
    if(r.id==='sadaqa') Metrics.charity += r.points;
    if(r.id==='salah')  Metrics.salah   += r.points;
    if(r.id==='iman')   Metrics.iman    += r.points;
    if(r.id==='birr')   Metrics.birr    += r.points;
    if(r.id==='siyam')  Metrics.siyam   += r.points;
    if(r.id==='silah')  Metrics.silah   += r.points;
  }
  function applyKeywordPoints(desc, points, type){
    const isGood=(type==='good'); const P=isGood?points:-points; const d=desc.replace(/\s+/g,'');
    if(/ØµØ¯Ù‚Ø©|ØªØµØ¯Ù‚/.test(d)) Metrics.charity += P;
    if(/Ù‚Ø±Ø¢Ù†|ØªØ­ÙÙŠØ¸|Ø­ÙØ¸|ØªÙ„Ø§ÙˆØ©/.test(d)) Metrics.quran += P;
    if(/ØµÙ„Ø§Ø©Ø¹Ù„Ù‰Ø§Ù„Ù†Ø¨ÙŠ|ØµÙ„Ø¹Ù„Ù‰Ø§Ù„Ù†Ø¨ÙŠ|Ø§Ù„ØµÙ„Ø§Ø©Ø¹Ù„Ù‰Ø§Ù„Ù†Ø¨ÙŠ/.test(d)) Metrics.salawat += P;
    if(/Ø§Ø³ØªØºÙØ§Ø±|Ø°ÙƒØ±|ØªØ³Ø¨ÙŠØ­|ØªÙ‡Ù„ÙŠÙ„|ØªØ­Ù…ÙŠØ¯/.test(d)) Metrics.dhikr += P;
    if(/ØµÙ„Ø§Ø©|Ù…Ø³Ø¬Ø¯|Ù‚ÙŠØ§Ù…/.test(d)) Metrics.salah += P;
    if(/Ø¥Ø­Ø³Ø§Ù†Ù„Ù„|Ø¨Ø±/.test(d)) Metrics.birr += P;
    if(/ØµÙˆÙ…|ØµÙŠØ§Ù…/.test(d)) Metrics.siyam += P;
    if(/ØµÙ„Ø©Ø§Ù„Ø±Ø­Ù…|Ø²ÙŠØ§Ø±Ø©Ø£Ù‚Ø§Ø±Ø¨/.test(d)) Metrics.silah += P;
    if(/Ø¥ÙŠÙ…Ø§Ù†|ØªÙˆØ­ÙŠØ¯/.test(d)) Metrics.iman += P;
  }

  /* =============== ÙƒØ±Ø§Ù…Ø§Øª ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© =============== */
  const Honors=[
    { id:'shadeThrone', icon:'ğŸŒ¤ï¸', title:'Ø§Ù„Ø¸Ù„ ØªØ­Øª Ø§Ù„Ø¹Ø±Ø´',
      explain:'Ø³Ø¨Ø¹Ø© ÙŠØ¸Ù„Ù‡Ù… Ø§Ù„Ù„Ù‡ ÙÙŠ Ø¸Ù„Ù‡â€¦ Ù…Ø¤Ø´Ø± Ø±Ù…Ø²ÙŠ ÙŠØªØ¯Ø±Ø¬ Ø¨ØªØ­Ù‚Ù‚ Ù…Ø¹Ø§Ù†ÙŠÙ‡Ø§ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.',
      compute: ()=>{ let axes=0; if(Metrics.salah>=40)axes++; if(Metrics.charity>=40)axes++; if(Metrics.iman>=25)axes++; if(Metrics.birr>=18)axes++; if(Metrics.siyam>=24)axes++; if((clicks["zina"]||0)===0)axes++; return Math.min(1,axes/6); }
    },
    { id:'charityShade', icon:'ğŸ•¯ï¸', title:'Ø§Ù„Ù…Ø±Ø¡ ÙÙŠ Ø¸Ù„ ØµØ¯Ù‚ØªÙ‡',
      explain:'ÙŠØªÙ‚ÙˆÙ‰ Ø§Ù„Ø¸Ù„ Ø¨Ù‚Ø¯Ø± Ø§Ù„ØµØ¯Ù‚Ø©. ØªØ¯Ø±Ø¬ Ø±Ù…Ø²ÙŠ ÙŠØ±ØªÙØ¹ Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ¯Ù‚Ø©.',
      compute: ()=> Math.min(1, Metrics.charity/100)
    },
    { id:'crownQuran', icon:'ğŸ‘‘', title:'ØªØ§Ø¬ Ø§Ù„ÙˆÙ‚Ø§Ø±',
      explain:'Ù„Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù‚Ø±Ø¢Ù†. Ù…Ù‚ÙŠØ§Ø³ Ø±Ù…Ø²ÙŠ ÙŠØªØ¯Ø±Ø¬ Ø¨Ù‚Ø¯Ø± Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆÙŠØ²Ø¯Ø§Ø¯ Ø¨Ø¨Ø± Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†.',
      compute: ()=> Math.min(1, Metrics.quran/200 + (Metrics.birr>0?0.1:0))
    },
    { id:'shafaa', icon:'ğŸ¤²', title:'Ø§Ù„Ø´ÙØ§Ø¹Ø©',
      explain:'ÙŠØªØ¯Ø±Ø¬ Ø±Ù…Ø²ÙŠÙ‹Ø§ Ù…Ø¹ Ù‚ÙˆØ© Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† ÙˆØµØ§ÙÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù† (Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡).',
      compute: ()=>{ const net=goodTotal-badTotal; return Math.max(0, Math.min(1, (Metrics.iman/50)*0.6 + (net>50?0.4:0))); }
    },
    { id:'hawd', icon:'ğŸï¸', title:'Ø§Ù„Ø­ÙˆØ¶ ÙˆØ§Ù„ÙƒÙˆØ«Ø±',
      explain:'ÙŠÙ‚ÙˆÙ‰ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ØµÙ„Ø§Ø© ÙˆÙƒØ«Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º.',
      compute: ()=> Math.min(1, (Metrics.salah/60)*0.6 + (Metrics.salawat/100)*0.4)
    },
    { id:'siratLight', icon:'ğŸ’¡', title:'Ù†ÙˆØ± Ø§Ù„ØµØ±Ø§Ø·',
      explain:'ÙŠØªÙ‚ÙˆÙ‰ Ø¨Ø§Ù„Ù†ÙˆØ± Ø§Ù„Ù†Ø§Ø´Ø¦ Ø¹Ù† Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† ÙˆØ§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø°ÙƒØ±.',
      compute: ()=> Math.min(1, (Metrics.iman+Metrics.salah+Metrics.dhikr)/200)
    }
  ];
  function createHonorCard(h){
    const grid=document.getElementById('honorsGrid');
    const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
    const gradId=`hgrad_${h.id}`; const [c1,c2]=gradientStops('good');
    const card=document.createElement('div'); card.className='honor-card'; card.id='hon_'+h.id;
    const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';
    ringwrap.innerHTML=`
      <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
        <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs>
        <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
        <circle class="prog-good" id="hprog_${h.id}" cx="${cx}" cy="${cy}" r="${r0}" stroke="url(#${gradId})" stroke-linecap="round" stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
      </svg>`;
    const inner=document.createElement('div'); inner.className='inner';
    inner.innerHTML=`<div class="icon">${h.icon}</div><div class="title">${h.title}</div><div class="meta" id="hmeta_${h.id}">0%</div>`;
    const help=document.createElement('div'); help.className='help'; help.textContent='?'; help.onclick=()=>openModal(h.title,h.explain);
    const badge=document.createElement('div'); badge.className='count-badge'; badge.textContent='â€”';
    ringwrap.appendChild(inner); ringwrap.appendChild(help); ringwrap.appendChild(badge);
    card.appendChild(ringwrap); grid.appendChild(card);
    card._C=C; card._badge=badge;
  }
  function updateHonorCard(h){
    const card=document.getElementById('hon_'+h.id); if(!card) return;
    const C=card._C; const v=Math.max(0,Math.min(1,h.compute())); const offset=C*(1-v);
    document.getElementById('hprog_'+h.id).style.strokeDashoffset=offset;
    document.getElementById('hmeta_'+h.id).textContent=Math.round(v*100)+'%';
    card._badge.textContent = (h.id==='charityShade')?Math.round(Metrics.charity)+' ØµØ¯Ù‚Ø©'
                          : (h.id==='crownQuran')?Math.round(Metrics.quran)+' Ù‚Ø±Ø¢Ù†'
                          : (h.id==='shafaa')?(goodTotal-badTotal)+' ØµØ§ÙÙŠ' : 'âœ“';
  }
  function renderHonors(){ Honors.forEach(h=>createHonorCard(h)); updateHonors(); }
  function updateHonors(){ Honors.forEach(h=>updateHonorCard(h)); }

  /* =============== Ø¥Ù‡Ø§Ù†Ø§Øª ÙˆØ¹Ù‚ÙˆØ¨Ø§Øª (ØªØ­Ø°ÙŠØ±) =============== */
  const Warnings=[
    { id:'bookLeft', icon:'ğŸ“„', title:'Ø£Ø®Ø° Ø§Ù„ÙƒØªØ§Ø¨ Ø¨Ø§Ù„Ø´Ù…Ø§Ù„',
      explain:'ØªØ­Ø°ÙŠØ± Ø±Ù…Ø²ÙŠ ÙŠØ±ØªÙØ¹ Ù…Ø¹ Ø§Ù„Ø³ÙŠØ¦Ø§Øª Ø§Ù„ØµØ±ÙØ© ÙˆÙ†Ù‚Øµ Ø§Ù„Ø­Ø³Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.',
      compute: ()=> Math.max(0, Math.min(1, (badTotal - goodTotal)/120 ))
    },
    { id:'deniedShade', icon:'â˜€ï¸', title:'Ø§Ù„Ø­Ø±Ù…Ø§Ù† Ù…Ù† Ø§Ù„Ø¸Ù„',
      explain:'ÙŠØ±ØªÙØ¹ Ù…Ø¹ Ø§Ù„Ø¸Ù„Ù… ÙˆØ§Ù„Ø°Ù†ÙˆØ¨ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (ÙƒØªØ±Ùƒ Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ¹Ù‚ÙˆÙ‚ Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†).',
      compute: ()=> Math.max(0, Math.min(1, ((clicks["tarkSalah"]||0)*15 + (clicks["uquq"]||0)*15 + badTotal*0.2)/100 ))
    },
    { id:'drivenOnFaces', icon:'â›“ï¸', title:'Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬ÙˆÙ‡',
      explain:'Ø±Ù…Ø²ÙŠÙ‹Ø§ Ù…Ø¹ ØªØ±Ø§ÙƒÙ… Ø§Ù„ÙƒØ¨Ø§Ø¦Ø± ÙˆÙ‚Ø³ÙˆØ© Ø§Ù„Ù‚Ù„Ø¨.',
      compute: ()=> Math.max(0, Math.min(1, ( (clicks["zina"]||0)*20 + (clicks["riba"]||0)*15 + badTotal*0.15 )/120 ))
    },
    { id:'deniedHawd', icon:'ğŸš±', title:'Ø§Ù„Ø°ÙÙ‘ÙˆÙ’Ø¯ Ø¹Ù† Ø§Ù„Ø­ÙˆØ¶',
      explain:'ÙŠÙ†Ø®ÙØ¶ Ø¨Ø§Ù„Ø§ØªØ¨Ø§Ø¹ Ù„Ù„Ø³Ù†Ù‘Ø© ÙˆÙƒØ«Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º.',
      compute: ()=> { let v=Math.max(0, 1 - (Metrics.salawat/120 + Metrics.salah/100)); return Math.min(1,v); }
    },
    { id:'exposed', icon:'ğŸ«¢', title:'Ø§Ù„ÙØ¶ÙŠØ­Ø© Ø£Ù…Ø§Ù… Ø§Ù„Ø®Ù„Ù‚',
      explain:'ÙŠÙ†Ø®ÙØ¶ Ø¨Ø§Ù„Ø³ØªØ± ÙˆØ§Ù„ØªÙˆØ¨Ø© ÙˆØ±Ø¯Ù‘ Ø§Ù„Ù…Ø¸Ø§Ù„Ù….',
      compute: ()=> Math.max(0, Math.min(1, (badTotal*0.01 + ((clicks["namimahR"]||0)*0.05)) ))
    }
  ];
  function createWarnCard(w){
    const grid=document.getElementById('warningsGrid');
    const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
    const gradId=`wgrad_${w.id}`; const [c1,c2]=gradientStops('bad');
    const card=document.createElement('div'); card.className='warn-card'; card.id='wrn_'+w.id;
    const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';
    ringwrap.innerHTML=`
      <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
        <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs>
        <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
        <circle class="prog-bad" id="wprog_${w.id}" cx="${cx}" cy="${cy}" r="${r0}" stroke="url(#${gradId})" stroke-linecap="round" stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
      </svg>`;
    const inner=document.createElement('div'); inner.className='inner';
    inner.innerHTML=`<div class="icon">${w.icon}</div><div class="title">${w.title}</div><div class="meta" id="wmeta_${w.id}">0%</div>`;
    const help=document.createElement('div'); help.className='help'; help.textContent='?'; help.onclick=()=>openModal(w.title,w.explain);
    const badge=document.createElement('div'); badge.className='count-badge bad'; badge.textContent='â€”';
    ringwrap.appendChild(inner); ringwrap.appendChild(help); ringwrap.appendChild(badge);
    card.appendChild(ringwrap); grid.appendChild(card);
    card._C=C; card._badge=badge;
  }
  function updateWarnCard(w){
    const card=document.getElementById('wrn_'+w.id); if(!card) return;
    const C=card._C; const v=Math.max(0,Math.min(1,w.compute())); const offset=C*(1-v);
    document.getElementById('wprog_'+w.id).style.strokeDashoffset=offset;
    document.getElementById('wmeta_'+w.id).textContent=Math.round(v*100)+'%';
    card._badge.textContent = Math.round(v*100)+'%';
  }
  function renderWarnings(){ Warnings.forEach(w=>createWarnCard(w)); updateWarnings(); }
  function updateWarnings(){ Warnings.forEach(w=>updateWarnCard(w)); }

  /* =============== Ù…Ø´Ø§Ù‡Ø¯ ÙˆØ£Ø­Ø¯Ø§Ø« Ø¹Ø§Ù…Ø© (Ø­ÙŠØ§Ø¯ÙŠ) =============== */
  const Scenes=[
    { id:'sweat', icon:'ğŸ’§', title:'Ø§Ù„Ø¹Ø±Ù‚ Ø¹Ù„Ù‰ Ù‚Ø¯Ø± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„',
      explain:'ØªØ¯Ù†Ùˆ Ø§Ù„Ø´Ù…Ø³â€¦ ÙÙŠÙƒÙˆÙ† Ø§Ù„Ù†Ø§Ø³ ÙÙŠ Ø§Ù„Ø¹Ø±Ù‚ Ø¹Ù„Ù‰ Ù‚Ø¯Ø± Ø£Ø¹Ù…Ø§Ù„Ù‡Ù…. Ù…Ø¤Ø´Ø± Ø±Ù…Ø²ÙŠ ÙŠØ±ØªÙØ¹ Ù…Ø¹ ÙƒÙØ¨ÙØ± ØµØ§ÙÙŠ Ø§Ù„Ø³ÙŠØ¦Ø§Øª.',
      compute: ()=> { const imbalance=Math.max(0,badTotal-goodTotal); return Math.min(1, imbalance/120 ); },
      badge: ()=> (badTotal-goodTotal>0? (badTotal-goodTotal)+' Ø³ÙŠØ¦Ø§Øª ØµØ§ÙÙŠØ©':'Ù…ØªÙˆØ§Ø²Ù†')
    },
    { id:'longStanding', icon:'â³', title:'Ø§Ù„ÙˆÙ‚ÙˆÙ Ø§Ù„Ø·ÙˆÙŠÙ„',
      explain:'ÙŠÙˆÙ… Ù…Ù‚Ø¯Ø§Ø±Ù‡ Ø®Ù…Ø³ÙˆÙ† Ø£Ù„Ù Ø³Ù†Ø©. Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø±Ù…Ø²ÙŠ ÙŠØ±ØªÙØ¹ ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯Øª Ø§Ù„Ø£ÙˆØ²Ø§Ø± ÙˆØ¶Ø¹Ù Ø§Ù„Ø±ØµÙŠØ¯.',
      compute: ()=> Math.min(1, (badTotal*0.5 - goodTotal*0.2 + 20)/120 )
    },
    { id:'balance', icon:'âš–ï¸', title:'Ø§Ù„Ù…ÙŠØ²Ø§Ù†',
      explain:'Ø«ÙÙ‚ÙÙ„ Ø§Ù„Ø­Ø³Ù†Ø§Øª ÙŠØ®ÙÙ Ø§Ù„Ù…Ø´Ù‡Ø¯. Ø§Ù„Ù…Ø¤Ø´Ø± Ù‡Ù†Ø§ Ø¹ÙƒØ³ÙŠ: Ø§Ù…ØªÙ„Ø§Ø¤Ù‡ ÙŠØ¹Ù†ÙŠ â€œØ£Ù…Ø§Ù†â€ Ø£ÙƒØ«Ø±.',
      compute: ()=> Math.max(0, Math.min(1, goodTotal/(badTotal+goodTotal+1) ))
    },
    { id:'suhuf', icon:'ğŸ“š', title:'ØªØ·Ø§ÙŠØ± Ø§Ù„ØµØ­Ù',
      explain:'Ø¸Ù‡ÙˆØ± Ù…Ø¤Ø´Ø± Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØºÙ„Ø¨ Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø­Ø³Ù†Ø§Øª ÙˆØµØ¯Ù‚ Ø§Ù„Ø¹Ù…Ù„.',
      compute: ()=> Math.max(0, Math.min(1, (goodTotal-badTotal+50)/150 ))
    }
  ];
  function createSceneCard(s){
    const grid=document.getElementById('scenesGrid');
    const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
    const gradId=`sgrad_${s.id}`; const [c1,c2]=gradientStops('info');
    const card=document.createElement('div'); card.className='scene-card'; card.id='scn_'+s.id;
    const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';
    ringwrap.innerHTML=`
      <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
        <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs>
        <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
        <circle class="prog-info" id="sprog_${s.id}" cx="${cx}" cy="${cy}" r="${r0}" stroke="url(#${gradId})" stroke-linecap="round" stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
      </svg>`;
    const inner=document.createElement('div'); inner.className='inner';
    inner.innerHTML=`<div class="icon">${s.icon}</div><div class="title">${s.title}</div><div class="meta" id="smeta_${s.id}">0%</div>`;
    const help=document.createElement('div'); help.className='help'; help.textContent='?'; help.onclick=()=>openModal(s.title,s.explain);
    const badge=document.createElement('div'); badge.className='count-badge'; badge.textContent='â€”';
    ringwrap.appendChild(inner); ringwrap.appendChild(help); ringwrap.appendChild(badge);
    card.appendChild(ringwrap); grid.appendChild(card);
    card._C=C; card._badge=badge;
  }
  function updateSceneCard(s){
    const card=document.getElementById('scn_'+s.id); if(!card) return;
    const C=card._C; const v=Math.max(0,Math.min(1,s.compute())); const offset=C*(1-v);
    document.getElementById('sprog_'+s.id).style.strokeDashoffset=offset;
    document.getElementById('smeta_'+s.id).textContent=Math.round(v*100)+'%';
    if(typeof s.badge==='function') card._badge.textContent=s.badge(); else card._badge.textContent=Math.round(v*100)+'%';
  }
  function renderScenes(){ Scenes.forEach(s=>createSceneCard(s)); updateScenes(); }
  function updateScenes(){ Scenes.forEach(s=>updateSceneCard(s)); }

  /* =============== ØªØ­Ø¯ÙŠØ« Ø´Ø§Ù…Ù„ =============== */
  function refreshUI(){ updateNetResult(); updateGraveMeter(); autoUpdateFinalJudgment(); updateHonors(); updateWarnings(); updateScenes(); }

  /* =============== ØªØ´ØºÙŠÙ„ =============== */
  window.onload=()=>{ populateDropdowns(); renderReasons(); renderHonors(); renderWarnings(); renderScenes(); refreshUI(); };

  /* =============== Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­ =============== */
  function openModal(title, body){ document.getElementById('modalTitle').textContent=title; document.getElementById('modalBody').textContent=body; document.getElementById('modal').classList.add('active'); }
  function closeModal(){ document.getElementById('modal').classList.remove('active'); }
</script>
</body>
</html>
