<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ميزان أعمالي — صفحة واحدة</title>
  <style>
    body{font-family:Tahoma,Arial,sans-serif;background:#f5f5f5;margin:0;padding:16px;text-align:center}
    h1{color:#2e7d32;margin:6px 0 10px}
    .row{display:flex;justify-content:center;gap:24px;flex-wrap:wrap}
    .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 0 8px rgba(0,0,0,.1);width:320px}
    input,select,button{width:90%;padding:8px;margin:4px 0;border:1px solid #ddd;border-radius:6px;font-size:14px}
    ul{list-style:none;margin:10px 0;padding:0;text-align:right;max-height:220px;overflow:auto}
    li{background:#e0f2f1;margin-bottom:6px;padding:8px;border-radius:6px;cursor:pointer}
    .muted{font-size:12px;color:#666}
    .summary{margin:10px 0 14px;font-weight:bold}
    /* تذكير */
    .rem{background:#fff3cd;color:#856404;border:1px solid #ffeeba}
    .rem button{background:#ffc107;border:none}
    /* عداد القبر */
    .grave{background:#fdecea;color:#611a15;border:1px solid #f5c6cb}
    .barWrap{background:#f8d7da;border-radius:20px;overflow:hidden;height:22px;margin:8px 0}
    .bar{height:100%;width:0%;background:#dc3545;transition:width .4s}
    /* التخفيف */
    .miti{background:#eef7ff;color:#053b74;border:1px solid #cfe8ff}
    .miti .btns{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
    .miti .btns button{background:#1976d2;color:#fff;border:none;width:auto}
    /* الجزاء النهائي */
    .final{background:#e8f5e9;color:#1b5e20;border:1px solid #c8e6c9}
    .meterWrap{display:flex;justify-content:center;align-items:center;gap:18px;margin-top:8px}
    .meter{width:36px;height:200px;background:#ddd;border-radius:20px;position:relative;overflow:hidden}
    #judgmentIndicator{position:absolute;bottom:0;width:100%;height:0%;background:linear-gradient(to top,#dc3545,#ffc107,#4caf50);transition:height .4s}
    .colLbl{width:90px;font-weight:bold}
  </style>
</head>
<body>
  <h1>📖 ميزان أعمالي</h1>

  <!-- الحسنات والسيئات -->
  <div class="row">
    <div class="card" id="good">
      <h2>✅ الحسنات</h2>
      <select id="goodSelect"><option value="">اختر عملاً حسنًا</option></select>
      <button onclick="addFromSelect('good')">إضافة من القائمة</button>
      <input id="goodDesc" type="text" placeholder="وصف (اختياري)"/>
      <input id="goodPoints" type="number" placeholder="درجة (اختياري)"/>
      <button onclick="addEntry('good')">إضافة يدويًا</button>
      <div class="muted">اضغط على أي عنصر لحذفه</div>
      <ul id="goodList"></ul>
      <div><b>المجموع:</b> <span id="goodTotal">0</span></div>
    </div>

    <div class="card" id="bad">
      <h2>❌ السيئات</h2>
      <select id="badSelect"><option value="">اختر سيئة (عذاب القبر)</option></select>
      <button onclick="addFromSelect('bad')">إضافة من القائمة</button>
      <input id="badDesc" type="text" placeholder="وصف (اختياري)"/>
      <input id="badPoints" type="number" placeholder="درجة (اختياري)"/>
      <button onclick="addEntry('bad')">إضافة يدويًا</button>
      <div class="muted">اضغط على أي عنصر لحذفه</div>
      <ul id="badList"></ul>
      <div><b>المجموع:</b> <span id="badTotal">0</span></div>
    </div>
  </div>

  <!-- صافي النقاط -->
  <div class="summary">⚖️ الفارق = <span id="netResult">0</span> نقطة</div>

  <!-- التذكير + عداد القبر + التخفيف -->
  <div class="row">
    <div class="card rem">
      <h3>☠️ تذكير القبر</h3>
      <div id="reminderText" class="muted">اضغط زر التذكير</div>
      <button onclick="showReminder()">ذكرني اليوم</button>
    </div>

    <div class="card grave">
      <h3>📉 عداد عذاب القبر</h3>
      <div class="barWrap"><div id="graveProgress" class="bar"></div></div>
      <div id="graveLevel">المستوى: آمن</div>
    </div>

    <div class="card miti">
      <h3>🛡️ تخفيف الخطر (24 ساعة/خيار)</h3>
      <div class="btns">
        <button onclick="applyMitigation('tawba')">توبة نصوح</button>
        <button onclick="applyMitigation('surahMulk')">سورة الملك</button>
        <button onclick="applyMitigation('repayDebt')">سداد دين/رد مظلمة</button>
        <button onclick="applyMitigation('cutNamimah')">قطع النميمة</button>
      </div>
      <div id="mitigationNote" class="muted">اختر إجراءً عند ارتفاع الخطر.</div>
    </div>
  </div>

  <!-- الجزاء النهائي -->
  <div class="row">
    <div class="card final" style="width:360px">
      <h3>🌌 الجزاء النهائي</h3>
      <div class="meterWrap">
        <div class="colLbl">🌴 الجنة</div>
        <div class="meter"><div id="judgmentIndicator"></div></div>
        <div class="colLbl">🔥 النار</div>
      </div>
      <div id="judgmentResult" class="muted">الحساب تلقائي حسب أعمالك.</div>
    </div>
  </div>

<script>
  const goodActions = [
    { text: "صلاة الفجر في وقتها", points: 20 },
    { text: "الصدقة على محتاج", points: 15 },
    { text: "قراءة القرآن", points: 10 },
    { text: "بر الوالدين", points: 25 },
    { text: "الاستغفار 100 مرة", points: 12 },
    { text: "قيام الليل", points: 18 },
    { text: "صلة الرحم", points: 16 }
  ];
  const badActions = [
    { text: "النميمة (نقل الكلام للإفساد)", points: 15 },
    { text: "عدم الاستنزاه من البول", points: 15 },
    { text: "الكذب المنتشر المؤذي", points: 20 },
    { text: "الزنا", points: 40 },
    { text: "ترك العمل بالقرآن/هجره بعد معرفته", points: 25 },
    { text: "الغلول/أخذ مال عام بغير حق", points: 30 },
    { text: "الدَّين مع المماطلة والقدرة على السداد", points: 20 }
  ];
  let goodTotal = 0, badTotal = 0;
  const K_GOOD = 0.6;
  const DANGER_THRESHOLDS = [30,60,85];
  const MITIGATION_POINTS = {tawba:25,surahMulk:10,repayDebt:35,cutNamimah:20};
  let mitigationTotal = 0;

  function populateDropdowns(){
    const g = document.getElementById('goodSelect');
    goodActions.forEach(a=>{
      const o=document.createElement('option');o.value=a.points;o.textContent=`${a.text} (+${a.points})`;g.appendChild(o);
    });
    const b = document.getElementById('badSelect');
    badActions.forEach(a=>{
      const o=document.createElement('option');o.value=a.points;o.textContent=`${a.text} (-${a.points})`;b.appendChild(o);
    });
  }
  function addFromSelect(type){
    const sel = document.getElementById(type==='good'?'goodSelect':'badSelect');
    if(!sel.value) return;
    document.getElementById(type+'Desc').value = sel.options[sel.selectedIndex].textContent;
    document.getElementById(type+'Points').value = sel.value;
    addEntry(type);
    sel.selectedIndex = 0;
  }
  function addEntry(type){
    const desc=(document.getElementById(`${type}Desc`).value||'').trim();
    const points=parseInt(document.getElementById(`${type}Points`).value,10);
    if(!desc || isNaN(points)) return;
    const list=document.getElementById(`${type}List`);
    const li=document.createElement('li');
    li.textContent=`${desc} (${points} نقطة)`;
    li.onclick=()=>{list.removeChild(li); if(type==='good'){goodTotal-=points;} else {badTotal-=points;} updateAll();};
    list.appendChild(li);
    if(type==='good'){goodTotal+=points;} else {badTotal+=points;}
    document.getElementById(`${type}Desc`).value='';document.getElementById(`${type}Points`).value='';
    updateAll();
  }
  function updateAll(){updateNetResult();updateGraveMeter();autoUpdateFinalJudgment();}
  function updateNetResult(){document.getElementById('netResult').textContent = goodTotal - badTotal;}
  function showReminder(){
    const arr=[
      "كان عثمان بن عفان إذا ذُكر القبر بكى حتى تبتل لحيته.",
      "القبر أول منازل الآخرة، فإن نجا منه فما بعده أيسر.",
      "أكثروا من ذكر هادم اللذات: الموت.",
      "اللهم قِنا عذاب القبر، وثبّتنا عند السؤال.",
      "استعدوا للقبر، فإن الليل والنهار يعملان فيكم."
    ];
    document.getElementById('reminderText').textContent = arr[Math.floor(Math.random()*arr.length)];
  }
  function canUseMitigation(k){
    const t=localStorage.getItem('mitigate_'+k);
    if(!t) return true;
    return ((Date.now()-parseInt(t,10))/(1000*60*60))>=24;
  }
  function markMitigationUsed(k){localStorage.setItem('mitigate_'+k,Date.now().toString());}
  function applyMitigation(k){
    const note=document.getElementById('mitigationNote');
    if(!MITIGATION_POINTS[k]) return;
    if(!canUseMitigation(k)){note.textContent="⏳ هذا الخيار استُخدم خلال 24 ساعة.";return;}
    mitigationTotal+=MITIGATION_POINTS[k];
    markMitigationUsed(k);
    note.textContent="✅ تم التخفيف. اثبت على الطاعة.";
    updateAll();
  }
  function computeGraveRisk(){
    let risk=badTotal - K_GOOD*goodTotal - mitigationTotal;
    if(risk<0) risk=0;if(risk>100) risk=100;
    return Math.round(risk);
  }
  function updateGraveMeter(){
    const risk=computeGraveRisk();
    document.getElementById('graveProgress').style.width = risk + '%';
    let label="آمن";
    if(risk>=DANGER_THRESHOLDS[0] && risk<DANGER_THRESHOLDS[1]) label="تحذير بسيط";
    else if(risk>=DANGER_THRESHOLDS[1] && risk<DANGER_THRESHOLDS[2]) label="خطر متوسط ⚠️";
    else if(risk>=DANGER_THRESHOLDS[2]) label="اقتراب شديد من العذاب 😟";
    document.getElementById('graveLevel').textContent="المستوى: "+label;
  }
  function autoUpdateFinalJudgment(){
    const net = goodTotal - badTotal;
    let h=50, txt="الحساب تلقائي حسب أعمالك.";
    if(net>100){h=100;txt="🥇 أعمالك عظيمة، وجهتك الجنة بإذن الله!";}
    else if(net>50){h=80;txt="🌿 مصيرك الجنة إن شاء الله، واصل الثبات.";}
    else if(net>0){h=65;txt="🤲 على الطريق، واصل العمل الصالح.";}
    else if(net===0){h=50;txt="⚖️ تعادل الحساب، فكن من المستغفرين.";}
    else if(net>-30){h=35;txt="❗ خطر! راجع نفسك قبل فوات الأوان.";}
    else if(net>-70){h=20;txt="🔥 تسارع نحو الخطر، بادر بالتوبة.";}
    else {h=5;txt="🚫 مصيرك النار إن لم تتب، اللهم سلم!";}
    document.getElementById('judgmentIndicator').style.height = h + '%';
    document.getElementById('judgmentResult').textContent = txt;
  }
  window.onload=function(){populateDropdowns();updateAll();}
</script>
</body>
</html>
