<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ميزان أعمالي</title>
  <style>
    body {
      font-family: 'Tahoma';
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #2e7d32; }
    .container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .column {
      background-color: white;
      padding: 20px;
      width: 300px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .column h2 { margin-top: 0; }
    input, button, select {
      padding: 8px;
      margin: 5px;
      width: 80%;
    }
    ul {
      list-style-type: none;
      padding: 0;
      margin: 15px 0;
    }
    li {
      margin-bottom: 5px;
      background-color: #e0f2f1;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
    }
    .summary {
      margin-top: 30px;
      font-size: 1.2em;
      color: #333;
    }

    /* تذكير */
    .reminder-box {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      padding: 20px;
      margin: 40px auto 20px;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .reminder-box button {
      background-color: #ffc107;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
    }

    /* عداد القبر */
    .grave-meter-box {
      background-color: #fdecea;
      color: #611a15;
      border: 1px solid #f5c6cb;
      padding: 20px;
      margin: 30px auto;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .progress-container {
      background-color: #f8d7da;
      border-radius: 20px;
      overflow: hidden;
      height: 25px;
      margin: 10px 0;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #dc3545;
      transition: width 0.5s ease-in-out;
    }

    /* التخفيف */
    .mitigation-box{
      background:#e9f3ff; color:#0f3b79; border:1px solid #cfe3ff;
      padding:20px; margin:30px auto; width:80%;
      border-radius:10px; box-shadow:0 0 10px #ccc;
    }
    .mitigation-box h2{ margin-top:0 }
    .miti-buttons{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap }
    .miti-buttons button{
      padding:10px 14px; border:none; border-radius:8px; background:#1976d2; color:#fff; cursor:pointer;
    }
    .miti-note{ margin-top:8px; font-size:.95em }

    /* الجزاء النهائي */
    .final-judgment-box {
      background-color: #e8f5e9;
      color: #1b5e20;
      border: 1px solid #c8e6c9;
      padding: 20px;
      margin: 30px auto;
      width: 80%;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    .judgment-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      gap: 30px;
    }
    .judgment-column { width: 100px; text-align: center; }
    .judgment-meter {
      width: 40px; height: 200px; background-color: #ddd;
      border-radius: 20px; position: relative; overflow: hidden;
    }
    #judgmentIndicator {
      position: absolute; width: 100%; height: 0%; bottom: 0;
      background: linear-gradient(to top, #dc3545, #ffc107, #4caf50);
      transition: height 0.5s ease-in-out;
    }
  </style>
</head>
<body>
  <h1>📖 ميزان أعمالي</h1>

  <div class="container">
    <div class="column" id="good">
      <h2>✅ الحسنات</h2>
      <input type="text" id="goodDesc" placeholder="وصف العمل" />
      <input type="number" id="goodPoints" placeholder="الدرجة" />
      <ul id="goodList"></ul>
      <strong>المجموع: <span id="goodTotal">0</span></strong>
    </div>

    <div class="column" id="bad">
      <h2>❌ السيئات</h2>
      <input type="text" id="badDesc" placeholder="وصف العمل" />
      <input type="number" id="badPoints" placeholder="الدرجة" />
      <ul id="badList"></ul>
      <strong>المجموع: <span id="badTotal">0</span></strong>
    </div>
  </div>

  <div class="summary">
    ⚖️ الفارق = <span id="netResult">0</span> نقطة
  </div>

  <!-- تذكير -->
  <div class="reminder-box">
    <h2>☠️ عذاب القبر – تذكير وتحذير</h2>
    <p id="reminderText">اضغط على الزر لتتذكر الآخرة...</p>
    <button onclick="showReminder()">ذكرني اليوم</button>
  </div>

  <!-- عداد القبر -->
  <div class="grave-meter-box">
    <h2>📉 عداد عذاب القبر</h2>
    <div class="progress-container">
      <div id="graveProgress" class="progress-bar"></div>
    </div>
    <p id="graveLevel">المستوى: آمن</p>
  </div>

  <!-- التخفيف -->
  <div class="mitigation-box">
    <h2>🛡️ التخفيف من عذاب القبر</h2>
    <div class="miti-buttons">
      <button onclick="applyMitigation('tawba')">توبة نصوح</button>
      <button onclick="applyMitigation('surahMulk')">سورة الملك ليلاً</button>
      <button onclick="applyMitigation('repayDebt')">سداد دين/رد مظلمة</button>
      <button onclick="applyMitigation('cutNamimah')">قطع النميمة</button>
    </div>
    <div id="mitigationNote" class="miti-note">كل خيار متاح مرة كل 24 ساعة.</div>
  </div>

  <!-- الجزاء النهائي -->
  <div class="final-judgment-box">
    <h2>🌌 الجزاء النهائي</h2>
    <div class="judgment-container">
      <div class="judgment-column"><h3>🌴 الجنة</h3></div>
      <div class="judgment-meter"><div id="judgmentIndicator"></div></div>
      <div class="judgment-column"><h3>🔥 النار</h3></div>
    </div>
    <p id="judgmentResult">⬅️ يتم حساب المصير تلقائيًا حسب أعمالك...</p>
  </div>

  <script>
    let goodTotal = 0;
    let badTotal = 0;

    /* معاملات التخفيف */
    const K_GOOD = 0.6; // وزن تأثير الحسنات
    const MITIGATION_POINTS = { tawba:25, surahMulk:10, repayDebt:35, cutNamimah:20 };
    let mitigationTotal = 0;

    function addEntry(type) {
      const desc = document.getElementById(`${type}Desc`).value;
      const points = parseInt(document.getElementById(`${type}Points`).value);
      if (!desc || isNaN(points)) return;

      const list = document.getElementById(`${type}List`);
      const li = document.createElement('li');
      li.textContent = `${desc} (${points} نقطة)`;
      li.onclick = () => {
        list.removeChild(li);
        if (type === 'good') {
          goodTotal -= points;
          document.getElementById('goodTotal').textContent = goodTotal;
        } else {
          badTotal -= points;
          document.getElementById('badTotal').textContent = badTotal;
        }
        updateAll();
      };
      list.appendChild(li);

      if (type === 'good') {
        goodTotal += points;
        document.getElementById('goodTotal').textContent = goodTotal;
      } else {
        badTotal += points;
        document.getElementById('badTotal').textContent = badTotal;
      }

      document.getElementById(`${type}Desc`).value = '';
      document.getElementById(`${type}Points`).value = '';
      updateAll();
    }

    function updateAll() {
      updateNetResult();
      updateGraveMeter();
      autoUpdateFinalJudgment();
    }

    function updateNetResult() {
      const net = goodTotal - badTotal;
      document.getElementById('netResult').textContent = net;
    }

    function showReminder() {
      const reminders = [
        "كان عثمان بن عفان إذا ذُكر القبر بكى حتى تبتل لحيته.",
        "القبر أول منازل الآخرة، فإن نجا منه فما بعده أيسر.",
        "أكثروا من ذكر هادم اللذات: الموت.",
        "اللهم قِنا عذاب القبر، وثبّتنا عند السؤال.",
        "استعدوا للقبر، فإن الليل والنهار يعملان فيكم."
      ];
      const text = reminders[Math.floor(Math.random() * reminders.length)];
      document.getElementById('reminderText').textContent = text;
    }

    /* التخفيف: مرة كل 24 ساعة لكل خيار */
    function canUseMitigation(key){
      const t = localStorage.getItem('miti_'+key);
      if(!t) return true;
      const hrs = (Date.now()-parseInt(t,10))/(1000*60*60);
      return hrs >= 24;
    }
    function markMitigationUsed(key){
      localStorage.setItem('miti_'+key, Date.now().toString());
    }
    function applyMitigation(key){
      const note = document.getElementById('mitigationNote');
      if(!MITIGATION_POINTS[key]) return;
      if(!canUseMitigation(key)){
        note.textContent = "⏳ هذا الخيار استُخدم خلال آخر 24 ساعة.";
        return;
      }
      mitigationTotal += MITIGATION_POINTS[key];
      markMitigationUsed(key);
      note.textContent = "✅ تم تطبيق إجراء التخفيف. اثبت على الطاعة واترك أسباب الخطر.";
      updateAll();
    }

    /* حساب خطر القبر (0..100) مع التخفيف */
    function computeGraveRisk(){
      let risk = badTotal - K_GOOD*goodTotal - mitigationTotal;
      if(risk < 0) risk = 0;
      if(risk > 100) risk = 100;
      return Math.round(risk);
    }

    function updateGraveMeter() {
      const levelText = document.getElementById("graveLevel");
      const progressBar = document.getElementById("graveProgress");
      const risk = computeGraveRisk(); // 0..100

      progressBar.style.width = risk + "%";

      let label = "آمن";
      if (risk > 10 && risk <= 30) label = "تحذير بسيط";
      else if (risk > 30 && risk <= 60) label = "خطر متوسط ⚠️";
      else if (risk > 60 && risk < 90) label = "اقتراب من العذاب 😟";
      else if (risk >= 90) label = "🔥 شديد الخطر – تب قبل فوات الأوان";

      levelText.textContent = "المستوى: " + label;
    }

    function autoUpdateFinalJudgment() {
      const result = document.getElementById("judgmentResult");
      const indicator = document.getElementById("judgmentIndicator");
      const net = goodTotal - badTotal;
      let heightPercent = 50;

      if (net > 100) { result.textContent = "🥇 أعمالك عظيمة، وجهتك الجنة بإذن الله!"; heightPercent = 100; }
      else if (net > 50) { result.textContent = "🌿 مصيرك الجنة إن شاء الله، واصل الثبات."; heightPercent = 80; }
      else if (net > 0) { result.textContent = "🤲 على الطريق، واصل العمل الصالح."; heightPercent = 65; }
      else if (net === 0) { result.textContent = "⚖️ تعادل الحساب، فكن من المستغفرين."; heightPercent = 50; }
      else if (net > -30) { result.textContent = "❗ خطر! راجع نفسك قبل فوات الأوان."; heightPercent = 35; }
      else if (net > -70) { result.textContent = "🔥 تسارع نحو الخطر، بادر بالتوبة."; heightPercent = 20; }
      else { result.textContent = "🚫 مصيرك النار إن لم تتب، اللهم سلم!"; heightPercent = 5; }

      indicator.style.height = heightPercent + "%";
    }

    /* القوائم الجاهزة */
    const goodActions = [
      { text: "صلاة الفجر في وقتها", points: 20 },
      { text: "الصدقة على محتاج", points: 15 },
      { text: "قراءة القرآن", points: 10 },
      { text: "بر الوالدين", points: 25 },
      { text: "الابتسامة في وجه أخيك", points: 5 },
      { text: "الاستغفار 100 مرة", points: 12 },
      { text: "قيام الليل", points: 18 }
    ];
    const badActions = [
      { text: "الكذب", points: 10 },
      { text: "النميمة", points: 15 },
      { text: "ترك الصلاة", points: 25 },
      { text: "إيذاء الآخرين", points: 12 },
      { text: "سماع الحرام", points: 8 },
      { text: "نظر محرم", points: 7 },
      { text: "الغيبة", points: 15 }
    ];

    function populateDropdowns() {
      const goodSelect = document.createElement("select");
      goodSelect.id = "goodSelect";
      goodSelect.innerHTML = '<option value="">اختر عملًا حسنًا</option>';
      goodActions.forEach(action => {
        const option = document.createElement("option");
        option.value = action.points;
        option.textContent = `${action.text} (+${action.points})`;
        goodSelect.appendChild(option);
      });
      const goodBtn = document.createElement("button");
      goodBtn.textContent = "إضافة";
      goodBtn.onclick = () => {
        const selected = goodSelect.options[goodSelect.selectedIndex];
        if (selected.value) {
          document.getElementById("goodDesc").value = selected.textContent;
          document.getElementById("goodPoints").value = selected.value;
          addEntry('good');
        }
      };

      const badSelect = document.createElement("select");
      badSelect.id = "badSelect";
      badSelect.innerHTML = '<option value="">اختر عملًا سيئًا</option>';
      badActions.forEach(action => {
        const option = document.createElement("option");
        option.value = action.points;
        option.textContent = `${action.text} (-${action.points})`;
        badSelect.appendChild(option);
      });
      const badBtn = document.createElement("button");
      badBtn.textContent = "إضافة";
      badBtn.onclick = () => {
        const selected = badSelect.options[badSelect.selectedIndex];
        if (selected.value) {
          document.getElementById("badDesc").value = selected.textContent;
          document.getElementById("badPoints").value = selected.value;
          addEntry('bad');
        }
      };

      document.getElementById("good").appendChild(goodSelect);
      document.getElementById("good").appendChild(goodBtn);
      document.getElementById("bad").appendChild(badSelect);
      document.getElementById("bad").appendChild(badBtn);
    }

    window.onload = () => {
      populateDropdowns();
      updateAll();
    };
  </script>
</body>
</html>
