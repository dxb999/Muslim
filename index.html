<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ميزان أعمالي</title>
  <style>
    body{font-family:Tahoma,Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;text-align:center}
    h1{color:#2e7d32}

    .container{display:flex;justify-content:center;gap:40px;margin-top:30px;flex-wrap:wrap}
    .column{background:#fff;padding:20px;width:300px;border-radius:10px;box-shadow:0 0 10px #ccc}
    .column h2{margin-top:0}
    input,button,select{padding:8px;margin:5px;width:80%}
    ul{list-style:none;padding:0;margin:15px 0}
    li{margin-bottom:5px;background:#e0f2f1;padding:8px;border-radius:5px;cursor:pointer}
    .summary{margin-top:30px;font-size:1.2em;color:#333}

    /* تذكير */
    .reminder-box{background:#fff3cd;color:#856404;border:1px solid #ffeeba;padding:20px;margin:40px auto 20px;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .reminder-box button{background:#ffc107;border:none;padding:10px 20px;font-size:1em;border-radius:5px;cursor:pointer}

    /* عداد القبر + التخفيف */
    .grave-meter-box{background:#fdecea;color:#611a15;border:1px solid #f5c6cb;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .progress-container{background:#f8d7da;border-radius:20px;overflow:hidden;height:25px;margin:10px 0}
    .progress-bar{height:100%;width:0%;background:#dc3545;transition:width .5s}
    .mitigation-box{background:#e9f3ff;color:#0f3b79;border:1px solid #cfe3ff;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .miti-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .miti-buttons button{padding:10px 14px;border:none;border-radius:8px;background:#1976d2;color:#fff;cursor:pointer}
    .miti-note{margin-top:8px;font-size:.95em}

    /* --- كرامات/تحذيرات/مشاهد --- */
    .day-honors,.day-warnings,.day-scenes{background:#fff;border:1px solid #eaeaea;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .day-honors h2,.day-warnings h2,.day-scenes h2{margin:0 0 8px}
    .honors-grid,.warnings-grid,.scenes-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:18px;justify-items:center}
    .honor-card,.warn-card,.scene-card{width:160px;display:flex;flex-direction:column;align-items:center;gap:8px}
    .ringwrap{position:relative;width:140px;height:140px}
    .inner{position:absolute;inset:28px;border-radius:50%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .inner .icon{font-size:26px}
    .inner .title{font-size:14px;color:#222}
    .inner .meta{font-size:12px;color:#666}
    .help{position:absolute;top:-6px;left:-6px;background:#00000080;color:#fff;width:20px;height:20px;border-radius:50%;display:grid;place-items:center;font-size:12px;cursor:pointer}
    .count-badge{position:absolute;bottom:-6px;right:-6px;background:#2e7d32;color:#fff;font-size:12px;border-radius:12px;padding:2px 6px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    .count-badge.bad{background:#dc3545}
    .track{stroke:#e5e5e5;stroke-width:30;fill:none}
    .prog-good{stroke-width:30;fill:none;transition:stroke-dashoffset .35s;filter:drop-shadow(0 0 8px rgba(46,125,50,.6))}
    .prog-bad {stroke-width:30;fill:none;transition:stroke-dashoffset .35s;filter:drop-shadow(0 0 8px rgba(220,53,69,.6))}
    .prog-info{stroke-width:30;fill:none;transition:stroke-dashoffset .35s;filter:drop-shadow(0 0 8px rgba(33,150,243,.6))}
    .svg{transform:rotate(-90deg)}

    /* إنفوجرافيك الأسباب (قسمان) */
    .infobox{background:#fff;border:1px solid #eaeaea;color:#1b1b1b;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .two-cols{display:grid;grid-template-areas:"good bad";gap:20px}
    .sec-good{grid-area:good}
    .sec-bad{grid-area:bad}
    @media(max-width:820px){.two-cols{grid-template-areas:"good" "bad"}}
    .infosec{border:1px dashed #ebebeb;border-radius:10px;padding:12px}
    .infosec h3{margin:0 0 10px}
    .infogrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px;justify-items:center}

    /* دوائر الأسباب (عرض 30 + تدرج + لمعة) */
    .reason{width:140px;height:170px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;user-select:none}
    .ringwrap .reason-inner{position:absolute;inset:28px;border-radius:50%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .reason .icon{font-size:30px;line-height:1}
    .reason .title{font-size:14px;color:#222}
    .reason .times{font-size:12px;color:#666}
    .count{position:absolute;bottom:-8px;right:-8px;background:#2e7d32;color:#fff;font-size:12px;border-radius:14px;padding:3px 8px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    .bad .count{background:#dc3545}
    .track-r{stroke:#e5e5e5;stroke-width:30;fill:none}
    .prog-good-r{stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(46,125,50,.6))}
    .prog-bad-r {stroke-width:30;fill:none;transition:stroke-dashoffset .25s;filter:drop-shadow(0 0 8px rgba(220,53,69,.6))}
    .svg-r{transform:rotate(-90deg)}

    /* الجزاء النهائي */
    .final-judgment-box{background:#e8f5e9;color:#1b5e20;border:1px solid #c8e6c9;padding:20px;margin:22px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .judgment-container{display:flex;justify-content:center;align-items:center;margin:20px 0;gap:30px}
    .judgment-column{width:100px;text-align:center}
    .judgment-meter{width:40px;height:200px;background:#ddd;border-radius:20px;position:relative;overflow:hidden}
    #judgmentIndicator{position:absolute;width:100%;height:0%;bottom:0;background:linear-gradient(to top,#dc3545,#ffc107,#4caf50);transition:height .45s}

    /* نافذة الشرح (Popup) */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal.active{display:flex}
    .modal .card{background:#fff;width:min(560px,92%);border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.25);overflow:hidden;text-align:right}
    .modal .card header{background:#2e7d32;color:#fff;padding:12px 16px;font-weight:bold}
    .modal .card .content{padding:16px;font-size:15px;color:#222;line-height:1.7}
    .modal .card footer{padding:12px 16px;text-align:left}
    .modal .card footer button{padding:8px 14px;border:none;background:#2e7d32;color:#fff;border-radius:8px;cursor:pointer}

    /* قسم القرآن */
    .quran-box{background:#fff;border:1px solid #eaeaea;padding:20px;margin:30px auto;width:80%;border-radius:10px;box-shadow:0 0 10px #ccc}
    .q-head{margin:0 0 10px}
    .q-controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;margin-bottom:10px}
    .q-controls select,.q-controls input{width:auto;min-width:140px}
    .q-stats{margin-top:8px;color:#333}
    .q-progress{background:#eee;border-radius:10px;overflow:hidden;height:14px;margin:10px auto;width:min(520px,90%)}
    .q-bar{height:100%;width:0%;transition:width .4s;background:linear-gradient(90deg,#2e7d32,#66bb6a)}
    .q-actions{margin-top:10px}
    .q-actions button{padding:8px 12px;border:none;border-radius:8px;background:#2e7d32;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <h1>📖 ميزان أعمالي</h1>

  <!-- الحسنات / السيئات -->
  <div class="container">
    <div class="column" id="good">
      <h2>✅ الحسنات</h2>
      <input type="text" id="goodDesc" placeholder="وصف العمل" />
      <input type="number" id="goodPoints" placeholder="الدرجة" />
      <button onclick="addEntry('good')">إضافة</button>
      <ul id="goodList"></ul>
      <strong>المجموع: <span id="goodTotal">0</span></strong>
    </div>
    <div class="column" id="bad">
      <h2>❌ السيئات</h2>
      <input type="text" id="badDesc" placeholder="وصف العمل" />
      <input type="number" id="badPoints" placeholder="الدرجة" />
      <button onclick="addEntry('bad')">إضافة</button>
      <ul id="badList"></ul>
      <strong>المجموع: <span id="badTotal">0</span></strong>
    </div>
  </div>

  <div class="summary">⚖️ الفارق = <span id="netResult">0</span> نقطة</div>

  <!-- تذكير -->
  <div class="reminder-box">
    <h2>☠️ عذاب القبر – تذكير وتحذير</h2>
    <p id="reminderText">اضغط على الزر لتتذكر الآخرة...</p>
    <button onclick="showReminder()">ذكرني اليوم</button>
  </div>

<!-- ======= مؤشر الالتزام بالصلاة (إلصقه حيث تريد داخل الصفحة) ======= -->
<section id="prayerSection" dir="rtl" style="font-family: Tahoma, Arial, sans-serif;">
  <style>
    #prayerSection *{box-sizing:border-box}
    #prayerSection .wrap{max-width:980px;margin:24px auto;background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:20px}
    #prayerSection h2{margin:0 0 6px;font-size:28px}
    #prayerSection .sub{color:#666;margin:2px 0 14px}
    /* رأس مع الشريط الرأسي */
    #prayerSection .head{display:flex;gap:16px;align-items:center;justify-content:space-between}
    #prayerSection .meterBox{display:flex;align-items:center;gap:14px}
    #prayerSection .meter{width:56px;height:220px;border:1.5px solid #d9d9d9;border-radius:14px;padding:6px;display:flex;flex-direction:column;justify-content:flex-end;background:#fafafa}
    #prayerSection .bar{width:100%;height:0;border-radius:10px;background:linear-gradient(#ef4444 0%, #f59e0b 50%, #22c55e 100%);transition:height .45s}
    #prayerSection .levelTag{display:flex;flex-direction:column;align-items:center;font-weight:700;color:#333}
    #prayerSection .levelPill{border:1px solid #e5e5e5;border-radius:12px;padding:4px 10px;margin-top:6px;background:#f8f8f8}
    /* شبكة المهام */
    #prayerSection .grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-top:18px}
    @media(max-width:820px){#prayerSection .grid{grid-template-columns:1fr}}
    #prayerSection .panel{border:1px dashed #ececec;border-radius:12px;padding:14px}
    #prayerSection .panel h3{margin:0 0 8px}
    #prayerSection .tasks{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:18px;justify-items:center}
    /* بطاقة مهمة */
    #prayerSection .task{width:160px;display:flex;flex-direction:column;align-items:center;gap:8px;user-select:none;cursor:pointer}
    #prayerSection .ringwrap{position:relative;width:140px;height:140px}
    /* حلقة سميكة + لمعة */
    #prayerSection .svg{transform:rotate(-90deg)}
    #prayerSection .track{stroke:#ececec;stroke-width:30;fill:none}
    #prayerSection .prog{stroke-width:30;fill:none;stroke-linecap:round;filter:drop-shadow(0 0 8px rgba(34,197,94,.55));transition:stroke-dashoffset .3s}
    #prayerSection .prog.badFx{filter:drop-shadow(0 0 8px rgba(239,68,68,.55))}
    /* محتوى الدائرة */
    #prayerSection .inner{position:absolute;inset:28px;border-radius:50%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    #prayerSection .icon{font-size:30px;line-height:1}
    #prayerSection .title{font-size:15px;color:#222}
    #prayerSection .count{position:absolute;bottom:-8px;right:-8px;background:#22c55e;color:#fff;font-size:12px;border-radius:14px;padding:3px 8px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    #prayerSection .count.bad{background:#ef4444}
    /* أرقام عامة */
    #prayerSection .scoreLine{font-size:18px;margin:10px 0 0}
    #prayerSection .scoreLine b{font-size:22px}
    #prayerSection .hint{color:#777;font-size:13px;margin-top:6px}
  </style>

  <div class="wrap">
    <div class="head">
      <div>
        <h2>🕌 مؤشر الالتزام بالصلاة</h2>
        <div class="sub">السِّتو: <span id="prayerLevelText">متوسط</span> – الامتثال الكلي: <b id="prayerPct">0%</b></div>
      </div>

      <div class="meterBox">
        <div class="levelTag">
          <div>مرتفع</div>
          <div class="levelPill" id="levelPill">متوسط</div>
        </div>
        <div class="meter">
          <div class="bar" id="prayerBar" style="height:0%"></div>
        </div>
      </div>
    </div>

    <div class="scoreLine">مساهمة المهام: <b id="prayerScoreNum">0</b> / 100</div>
    <div class="hint">اضغط لزيادة العدّاد، واضغط مطوّلًا/كِلك يمين للتنقيص. يُحدَّث المؤشر تلقائيًا.</div>

    <div class="grid">
      <!-- ترفع المؤشر -->
      <div class="panel">
        <h3>✅ أمور ترفع المؤشر</h3>
        <div class="tasks" id="raiseTasks"></div>
      </div>
      <!-- تُنقص المؤشر -->
      <div class="panel">
        <h3>❌ أمور تُنقص المؤشر</h3>
        <div class="tasks" id="lowerTasks"></div>
      </div>
    </div>
  </div>

  <script>
    // ——— الإعدادات
    const MAX_STEPS = 10;                 // لعرض الحلقة (لا يؤثر على النقاط مباشرة)
    const GOOD_GRAD = ['#22c55e','#86efac'];
    const BAD_GRAD  = ['#ef4444','#fca5a5'];

    // ——— تعريف المهام (نفس الأيقونات والروح)
    const RAISE = [
      { id:'jamaah',     title:'الجماعة بالمسجد', icon:'🕌',   weight:10 },
      { id:'takbira',    title:'تكبيرة الإحرام',  icon:'🏁',   weight:8  },
      { id:'fajrJam',    title:'الفجر جماعة',     icon:'🌅',   weight:10 },
      { id:'sunans',     title:'السنن الرواتب',   icon:'🧎‍♂️', weight:6  }
    ];
    const LOWER = [
      { id:'oversleep',  title:'النوم عن الصلاة', icon:'😴',  weight:10 },
      { id:'lateHabit',  title:'التأخير المعتاد', icon:'⏰',  weight:8  },
      { id:'phoneAdhan', title:'انشغال عند الأذان',icon:'📱',  weight:6  },
      { id:'skipJamaah', title:'ترك الجماعة',     icon:'⛔️',  weight:10 }
    ];

    // ——— حالة العدّادات
    const state = {};
    [...RAISE, ...LOWER].forEach(t => state[t.id] = 0);

    // ——— أدوات رسم الحلقة السميكة
    function makeTaskCard(task, type){ // type: 'good'|'bad'
      const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
      const gradId = `grad_${type}_${task.id}`;
      const [c1,c2] = (type==='good')?GOOD_GRAD:BAD_GRAD;

      const card = document.createElement('div');
      card.className = 'task';
      card.id = `task_${task.id}`;

      const ring = document.createElement('div');
      ring.className = 'ringwrap';
      ring.innerHTML = `
        <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <defs>
            <linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%"  stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/>
            </linearGradient>
          </defs>
          <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
          <circle class="prog ${type==='bad'?'badFx':''}" id="prog_${task.id}"
                  cx="${cx}" cy="${cy}" r="${r0}" stroke="url(#${gradId})"
                  stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
        </svg>
      `;

      const inner = document.createElement('div');
      inner.className = 'inner';
      inner.innerHTML = `<div class="icon">${task.icon}</div><div class="title">${task.title}</div>`;

      const count = document.createElement('div');
      count.className = 'count' + (type==='bad'?' bad':'');
      count.id = `count_${task.id}`;
      count.textContent = '0×';

      ring.appendChild(inner);
      ring.appendChild(count);
      card.appendChild(ring);

      // أحداث الزيادة/النقص
      const inc = () => { state[task.id]++; updateTask(task.id, type); updateScore(); };
      const dec = () => { state[task.id] = Math.max(0, state[task.id]-1); updateTask(task.id, type); updateScore(); };
      card.addEventListener('click', inc);
      card.addEventListener('contextmenu', e => { e.preventDefault(); dec(); });
      // ضغطة مطوّلة للموبايل
      let pressTimer=null;
      card.addEventListener('touchstart', ()=>{ pressTimer=setTimeout(dec, 550); }, {passive:true});
      card.addEventListener('touchend', ()=>{ clearTimeout(pressTimer); });

      return card;
    }

    function updateTask(id, type){
      const steps = Math.min(MAX_STEPS, state[id]);
      const size=140, r0=36, C=2*Math.PI*r0;
      const pct  = steps/MAX_STEPS;             // 0..1 للحلقة فقط
      const offset = C*(1-pct);
      document.getElementById(`prog_${id}`).style.strokeDashoffset = offset;
      document.getElementById(`count_${id}`).textContent = state[id] + '×';
    }

    function renderTasks(){
      const g = document.getElementById('raiseTasks');
      const b = document.getElementById('lowerTasks');
      RAISE.forEach(t => g.appendChild(makeTaskCard(t,'good')));
      LOWER.forEach(t => b.appendChild(makeTaskCard(t,'bad')));
    }

    // ——— حساب المؤشر العام (0..100)
    function calcScore(){
      // مجموع إيجابي – مجموع سلبي (مقيد بين 0 و 100)
      const pos = RAISE.reduce((s,t)=> s + state[t.id]*t.weight, 0);
      const neg = LOWER.reduce((s,t)=> s + state[t.id]*t.weight, 0);
      const raw = pos - neg;               // يمكن أن يكون سالب
      const norm = Math.max(0, Math.min(100, raw)); // نقيده 0..100
      return {pos,neg,score:norm};
    }

    function updateScore(){
      const {pos,neg,score} = calcScore();
      // الشريط الرأسي
      document.getElementById('prayerBar').style.height = score + '%';
      // أرقام
      document.getElementById('prayerScoreNum').textContent = Math.round(score);
      document.getElementById('prayerPct').textContent      = Math.round(score) + '%';
      // مستوى نصي
      const pill = document.getElementById('levelPill');
      const lvlTxt = document.getElementById('prayerLevelText');
      let label='متوسط';
      if(score < 34) label='منخفض';
      else if(score >= 67) label='مرتفع';
      else label='متوسط';
      pill.textContent = label;
      lvlTxt.textContent = label;
    }

    // تشغيل
    renderTasks();
    updateScore();
  </script>
</section>
<!-- ======= نهاية مكوّن مؤشر الصلاة ======= -->

  
  <!-- عداد القبر -->
  <div class="grave-meter-box">
    <h2>📉 عداد عذاب القبر</h2>
    <div class="progress-container"><div id="graveProgress" class="progress-bar"></div></div>
    <p id="graveLevel">المستوى: آمن</p>
  </div>

  <!-- التخفيف -->
  <div class="mitigation-box">
    <h2>🛡️ التخفيف من عذاب القبر</h2>
    <div class="miti-buttons">
      <button onclick="applyMitigation('tawba')">توبة نصوح</button>
      <button onclick="applyMitigation('surahMulk')">سورة الملك ليلاً</button>
      <button onclick="applyMitigation('repayDebt')">سداد دين/رد مظلمة</button>
      <button onclick="applyMitigation('cutNamimah')">قطع النميمة</button>
    </div>
    <div id="mitigationNote" class="miti-note">كل خيار متاح مرة كل 24 ساعة.</div>
  </div>

  <!-- 🕊️ كرامات يوم القيامة -->
  <div class="day-honors" id="honorsBox">
    <h2>🕊️ كرامات يوم القيامة</h2>
    <p style="color:#555;margin:6px 0 16px">تمثيل رمزي مبني على بياناتك (للتذكير والتحفيز).</p>
    <div class="honors-grid" id="honorsGrid"></div>
  </div>

  <!-- ❗ إهانات وعقوبات يوم القيامة -->
  <div class="day-warnings" id="warningsBox">
    <h2>❗ إهانات وعقوبات يوم القيامة</h2>
    <p style="color:#555;margin:6px 0 16px">مؤشرات تحذيرية رمزية تقلّ بالتوبة وترك أسبابها.</p>
    <div class="warnings-grid" id="warningsGrid"></div>
  </div>

  <!-- 🌍 مشاهد وأحداث عامة يوم القيامة -->
  <div class="day-scenes" id="scenesBox">
    <h2>🌍 مشاهد وأحداث عامة يوم القيامة</h2>
    <p style="color:#555;margin:6px 0 16px">عرض توعوي لأحوال عامة (مثل العرق على قدر الأعمال).</p>
    <div class="scenes-grid" id="scenesGrid"></div>
  </div>

  <!-- 📖 قسم قراءة القرآن (سورة أو صفحات) -->
  <div class="quran-box" id="quranBox">
    <h2 class="q-head">📖 قراءة القرآن – حساب الحروف والحسنات</h2>
    <div class="q-controls">
      <label>طريقة الإدخال:
        <select id="qMode" onchange="updateQuranMode()">
          <option value="surah">بالسورة</option>
          <option value="pages">بالصفحات</option>
        </select>
      </label>

      <span id="modeSurah">
        <select id="surahSelect"></select>
        مرات التلاوة
        <input id="surahTimes" type="number" min="1" value="1" title="مرات التلاوة" />
      </span>

      <span id="modePages" style="display:none">
        من صفحة <input id="pageStart" type="number" min="1" max="604" value="1" />
        إلى صفحة <input id="pageEnd" type="number" min="1" max="604" value="1" />
        (≈ 450 حرف/صفحة)
      </span>
    </div>

    <div class="q-stats">
      الحروف: <b id="qLetters">0</b> • الحسنات: <b id="qHasanat">0</b>
    </div>

    <div class="q-progress">
      <div id="qBar" class="q-bar"></div>
    </div>
    <div class="q-stats">
      التقدُّم: <b id="qProgressText">0</b> من <b>3,226,040</b> حسنة
    </div>

    <div class="q-actions">
      <button onclick="addQuranHasanat()">أضف للحسنات</button>
    </div>
  </div>

  <!-- إنفوجرافيك: الجنة والنار -->
  <div class="infobox">
    <h2>🧭 أسباب دخول الجنة والنار</h2>
    <div class="two-cols">
      <div class="infosec sec-good">
        <h3>🌴 أسباب دخول الجنة</h3>
        <div class="infogrid" id="reasonsGoodGrid"></div>
      </div>
      <div class="infosec sec-bad">
        <h3>🔥 أسباب دخول النار</h3>
        <div class="infogrid" id="reasonsBadGrid"></div>
      </div>
    </div>
  </div>

  <!-- الجزاء النهائي -->
  <div class="final-judgment-box">
    <h2>🌌 الجزاء النهائي</h2>
    <div class="judgment-container">
      <div class="judgment-column"><h3>🌴 الجنة</h3></div>
      <div class="judgment-meter"><div id="judgmentIndicator"></div></div>
      <div class="judgment-column"><h3>🔥 النار</h3></div>
    </div>
    <p id="judgmentResult">⬅️ يتم حساب المصير تلقائيًا حسب أعمالك...</p>
  </div>

  <!-- نافذة الشرح -->
  <div class="modal" id="modal"><div class="card">
    <header id="modalTitle">شرح</header>
    <div class="content" id="modalBody"></div>
    <footer><button onclick="closeModal()">إغلاق</button></footer>
  </div></div>

<script>
  /* =============== بيانات الميزان العامة =============== */
  let goodTotal=0, badTotal=0;
  const K_GOOD=0.6;
  const MITIGATION_POINTS={tawba:25,surahMulk:10,repayDebt:35,cutNamimah:20};
  let mitigationTotal=0;

  function addEntry(type){
    const desc=document.getElementById(`${type}Desc`).value.trim();
    const points=parseInt(document.getElementById(`${type}Points`).value);
    if(!desc||isNaN(points))return;
    const list=document.getElementById(`${type}List`);
    const li=document.createElement('li');
    li.textContent=`${desc} (${points} نقطة)`;
    li.onclick=()=>{list.removeChild(li); if(type==='good'){goodTotal-=points;} else {badTotal-=points;} refreshUI();};
    list.appendChild(li);
    if(type==='good'){goodTotal+=points;} else {badTotal+=points;}
    document.getElementById('goodTotal').textContent=goodTotal;
    document.getElementById('badTotal').textContent=badTotal;
    document.getElementById(`${type}Desc`).value=''; document.getElementById(`${type}Points`).value='';
    refreshUI();
  }

  function updateNetResult(){document.getElementById('netResult').textContent=goodTotal-badTotal;}

  function showReminder(){
    const reminders=["كان عثمان بن عفان إذا ذُكر القبر بكى حتى تبتل لحيته.","القبر أول منازل الآخرة، فإن نجا منه فما بعده أيسر.","أكثروا من ذكر هادم اللذات: الموت.","اللهم قِنا عذاب القبر، وثبّتنا عند السؤال.","استعدوا للقبر، فإن الليل والنهار يعملان فيكم."];
    document.getElementById('reminderText').textContent=reminders[Math.floor(Math.random()*reminders.length)];
  }

  function canUseMitigation(k){const t=localStorage.getItem('miti_'+k); if(!t) return true; return ((Date.now()-parseInt(t,10))/(1000*60*60))>=24;}
  function markMitigationUsed(k){localStorage.setItem('miti_'+k,Date.now().toString());}
  function applyMitigation(k){
    const note=document.getElementById('mitigationNote');
    if(!MITIGATION_POINTS[k])return;
    if(!canUseMitigation(k)){note.textContent="⏳ هذا الخيار استُخدم خلال آخر 24 ساعة.";return;}
    mitigationTotal+=MITIGATION_POINTS[k]; markMitigationUsed(k);
    note.textContent="✅ تم التخفيف. اثبت على الطاعة."; refreshUI();
  }

  function computeGraveRisk(){
    let risk=badTotal - K_GOOD*goodTotal - mitigationTotal;
    if(risk<0)risk=0; if(risk>100)risk=100; return Math.round(risk);
  }
  function updateGraveMeter(){
    const risk=computeGraveRisk();
    document.getElementById('graveProgress').style.width=risk+'%';
    let label="آمن";
    if(risk>10&&risk<=30)label="تحذير بسيط";
    else if(risk>30&&risk<=60)label="خطر متوسط ⚠️";
    else if(risk>60&&risk<90)label="اقتراب من العذاب 😟";
    else if(risk>=90)label="🔥 شديد الخطر – تب قبل فوات الأوان";
    document.getElementById('graveLevel').textContent='المستوى: '+label;
  }
  function autoUpdateFinalJudgment(){
    const net=goodTotal-badTotal;
    let h=50, txt="⚖️ تعادل الحساب، فكن من المستغفرين.";
    if(net>100){h=100;txt="🥇 أعمالك عظيمة، وجهتك الجنة بإذن الله!";}
    else if(net>50){h=80;txt="🌿 مصيرك الجنة إن شاء الله، واصل الثبات.";}
    else if(net>0){h=65;txt="🤲 على الطريق، واصل العمل الصالح.";}
    else if(net===0){h=50;txt="⚖️ تعادل الحساب، فكن من المستغفرين.";}
    else if(net>-30){h=35;txt="❗ خطر! راجع نفسك قبل فوات الأوان.";}
    else if(net>-70){h=20;txt="🔥 تسارع نحو الخطر، بادر بالتوبة.";}
    else {h=5;txt="🚫 مصيرك النار إن لم تتب، اللهم سلم!";}
    document.getElementById('judgmentIndicator').style.height=h+'%';
    document.getElementById('judgmentResult').textContent=txt;
  }

  /* =============== إنفوجرافيك الأسباب (SVG 30 + لمعة) =============== */
  const MAX_CLICKS=20;
  const REASONS_GOOD=[
    {id:'iman',icon:'🕋',label:'الإيمان',points:25},
    {id:'salah',icon:'🕌',label:'الصلاة',points:20},
    {id:'birr',icon:'👨‍👩‍👧‍👦',label:'برّ الوالدين',points:18},
    {id:'sadaqa',icon:'🤝',label:'الصدقة',points:15},
    {id:'siyam',icon:'🌙',label:'الصوم',points:12},
    {id:'silah',icon:'🧬',label:'صلة الرحم',points:12}
  ];
  const REASONS_BAD=[
    {id:'kufr',icon:'🚫',label:'الكفر/الشرك',points:40},
    {id:'tarkSalah',icon:'⛔️',label:'ترك الصلاة',points:30},
    {id:'uquq',icon:'💢',label:'عقوق الوالدين',points:25},
    {id:'zina',icon:'⚠️',label:'الزنا',points:35},
    {id:'riba',icon:'💸',label:'الربا',points:25},
    {id:'namimahR',icon:'🗣️',label:'النميمة',points:15}
  ];
  const clicks={};
  function gradientStops(type){
    if(type==='bad')   return ['#dc3545','#ff7043'];
    if(type==='info')  return ['#2196f3','#64b5f6'];
    return ['#2e7d32','#66bb6a'];
  }
  function createReasonEl(r,type,grid){
    clicks[r.id]=clicks[r.id]||0;
    const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
    const gradId=`grad_${type}_${r.id}`;
    const [c1,c2]=gradientStops(type);
    const wrap=document.createElement('div'); wrap.className='reason '+(type==='bad'?'bad':'good'); wrap.id='reason_'+r.id;
    const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';
    ringwrap.innerHTML=`
      <svg class="svg-r" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
        <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs>
        <circle class="track-r" cx="${cx}" cy="${cy}" r="${r0}"></circle>
        <circle class="${type==='bad'?'prog-bad-r':'prog-good-r'}" id="prog_${r.id}" cx="${cx}" cy="${cy}" r="${r0}"
          stroke="url(#${gradId})" stroke-linecap="round" stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
      </svg>`;
    const inner=document.createElement('div'); inner.className='reason-inner';
    inner.innerHTML=`<div class="icon">${r.icon}</div><div class="title">${r.label}</div><div class="times"><span id="t_${r.id}">0</span>×</div>`;
    const count=document.createElement('div'); count.className='count'; count.textContent='0×';
    ringwrap.appendChild(inner); ringwrap.appendChild(count); wrap.appendChild(ringwrap);

    wrap.onclick=()=>{
      if(clicks[r.id] >= MAX_CLICKS) return;
      clicks[r.id]++; const pct=clicks[r.id]/MAX_CLICKS; const offset=C*(1-pct);
      document.getElementById('prog_'+r.id).style.strokeDashoffset=offset;
      document.getElementById('t_'+r.id).textContent=clicks[r.id]; count.textContent=clicks[r.id]+'×';
      if(type==='good'){ goodTotal+=r.points; } else { badTotal+=r.points; }
      document.getElementById('goodTotal').textContent=goodTotal; document.getElementById('badTotal').textContent=badTotal;
      refreshUI();
    };
    grid.appendChild(wrap);
  }
  function renderReasons(){
    const gGrid=document.getElementById('reasonsGoodGrid');
    const bGrid=document.getElementById('reasonsBadGrid');
    REASONS_GOOD.forEach(r=>createReasonEl(r,'good',gGrid));
    REASONS_BAD.forEach(r=>createReasonEl(r,'bad',bGrid));
  }

  /* =============== قوائم جاهزة =============== */
  const goodActions=[{text:"صلاة الفجر في وقتها",points:20},{text:"الصدقة على محتاج",points:15},{text:"قراءة القرآن",points:10},{text:"بر الوالدين",points:25},{text:"الابتسامة في وجه أخيك",points:5},{text:"الاستغفار 100 مرة",points:12},{text:"قيام الليل",points:18},{text:"الصلاة على النبي ﷺ 100 مرة",points:12}];
  const badActions=[{text:"الكذب",points:10},{text:"النميمة",points:15},{text:"ترك الصلاة",points:25},{text:"إيذاء الآخرين",points:12},{text:"سماع الحرام",points:8},{text:"نظر محرم",points:7},{text:"الغيبة",points:15}];

  function populateDropdowns(){
    const goodSelect=document.createElement("select"); goodSelect.id="goodSelect"; goodSelect.innerHTML='<option value="">اختر عملًا حسنًا</option>';
    goodActions.forEach(a=>{const o=document.createElement("option"); o.value=a.points; o.textContent=`${a.text} (+${a.points})`; goodSelect.appendChild(o);});
    const goodBtn=document.createElement("button"); goodBtn.textContent="إضافة"; goodBtn.onclick=()=>{const s=goodSelect.options[goodSelect.selectedIndex]; if(s.value){document.getElementById("goodDesc").value=s.textContent; document.getElementById("goodPoints").value=s.value; addEntry('good');}};
    const badSelect=document.createElement("select"); badSelect.id="badSelect"; badSelect.innerHTML='<option value="">اختر عملًا سيئًا</option>';
    badActions.forEach(a=>{const o=document.createElement("option"); o.value=a.points; o.textContent=`${a.text} (-${a.points})`; badSelect.appendChild(o);});
    const badBtn=document.createElement("button"); badBtn.textContent="إضافة"; badBtn.onclick=()=>{const s=badSelect.options[badSelect.selectedIndex]; if(s.value){document.getElementById("badDesc").value=s.textContent; document.getElementById("badPoints").value=s.value; addEntry('bad');}};
    document.getElementById("good").appendChild(goodSelect); document.getElementById("good").appendChild(goodBtn);
    document.getElementById("bad").appendChild(badSelect); document.getElementById("bad").appendChild(badBtn);
  }

  /* =============== كرامات / تحذيرات / مشاهد =============== */
  const Honors=[
    { id:'shadeThrone', icon:'🌤️', title:'الظل تحت العرش', explain:'سبعة يظلهم الله في ظله… مؤشر رمزي يتدرج بتحقق معانيها.', compute: ()=> Math.min(1, (goodTotal>badTotal?0.6:0.2) + (goodTotal/200)) },
    { id:'charityShade', icon:'🕯️', title:'المرء في ظل صدقته', explain:'يتقوى الظل بقدر الصدقة.', compute: ()=> Math.min(1, (goodTotal/300)) },
    { id:'crownQuran', icon:'👑', title:'تاج الوقار', explain:'للأبوين بسبب القرآن؛ مؤشر رمزي مع مقدار التلاوة.', compute: ()=> Math.min(1, (quranHasanat/50000)) },
    { id:'shafaa', icon:'🤲', title:'الشفاعة', explain:'ترجى لأهل التوحيد والإخلاص؛ مؤشر رمزي بالإيمان وصافي الميزان.', compute: ()=> Math.min(1, (Math.max(0,goodTotal-badTotal)/150)) },
    { id:'hawd', icon:'🏞️', title:'الحوض والكوثر', explain:'يقوى بالاتباع والصلاة على النبي ﷺ (تمثيلي).', compute: ()=> Math.min(1, goodTotal/250) },
    { id:'siratLight', icon:'💡', title:'نور الصراط', explain:'الإيمان والعمل الصالح يورثان نورًا (تمثيلي).', compute: ()=> Math.min(1, goodTotal/(goodTotal+badTotal+1)) }
  ];
  const Warnings=[
    { id:'bookLeft', icon:'📄', title:'أخذ الكتاب بالشمال', explain:'تحذير رمزي يرتفع مع صافي السيئات.', compute: ()=> Math.max(0, Math.min(1, (badTotal - goodTotal)/120 )) },
    { id:'deniedShade', icon:'☀️', title:'الحرمان من الظل', explain:'يرتفع مع الظلم والذنوب الكبيرة.', compute: ()=> Math.max(0, Math.min(1, badTotal/150 )) },
    { id:'drivenOnFaces', icon:'⛓️', title:'السحب على الوجوه', explain:'رمزي مع تراكم الكبائر.', compute: ()=> Math.max(0, Math.min(1, badTotal/180 )) },
    { id:'deniedHawd', icon:'🚱', title:'الذَّوْد عن الحوض', explain:'ينخفض باتباع السنة وكثرة الصلاة على النبي ﷺ.', compute: ()=> Math.max(0, Math.min(1, 1 - (goodTotal/250) )) },
    { id:'exposed', icon:'🫢', title:'الفضيحة أمام الخلق', explain:'ينخفض بالستر والتوبة ورد المظالم.', compute: ()=> Math.max(0, Math.min(1, badTotal/200 )) }
  ];
  const Scenes=[
    { id:'sweat', icon:'💧', title:'العرق على قدر الأعمال', explain:'تدنو الشمس… فيكون العرق على قدر الأعمال.', compute: ()=> Math.min(1, Math.max(0,badTotal-goodTotal)/120 ) },
    { id:'longStanding', icon:'⏳', title:'الوقوف الطويل', explain:'يوم مقداره خمسون ألف سنة. مؤشر رمزي.', compute: ()=> Math.min(1, (badTotal*0.5 - goodTotal*0.2 + 20)/120 ) },
    { id:'balance', icon:'⚖️', title:'الميزان', explain:'امتلاؤه يعني أمان أكثر.', compute: ()=> Math.max(0, Math.min(1, goodTotal/(badTotal+goodTotal+1) )) },
    { id:'suhuf', icon:'📚', title:'تطاير الصحف', explain:'يقوى مع غلبة الحسنات.', compute: ()=> Math.max(0, Math.min(1, (goodTotal-badTotal+50)/150 )) }
  ];

  function createCircleCard(containerId, cfgList, kind){
    const grid=document.getElementById(containerId);
    cfgList.forEach(cfg=>{
      const size=140, r0=36, cx=size/2, cy=size/2, C=2*Math.PI*r0;
      const gradId=`${kind}grad_${cfg.id}`; const [c1,c2]=gradientStops(kind==='warn'?'bad': (kind==='scene'?'info':'good'));
      const card=document.createElement('div'); card.className=(kind==='warn'?'warn-card':(kind==='scene'?'scene-card':'honor-card')); card.id=`${kind}_${cfg.id}`;
      const ringwrap=document.createElement('div'); ringwrap.className='ringwrap';
      ringwrap.innerHTML=`
        <svg class="svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs>
          <circle class="track" cx="${cx}" cy="${cy}" r="${r0}"></circle>
          <circle class="${kind==='warn'?'prog-bad':(kind==='scene'?'prog-info':'prog-good')}" id="${kind}prog_${cfg.id}" cx="${cx}" cy="${cy}" r="${r0}" stroke="url(#${gradId})" stroke-linecap="round" stroke-dasharray="${C} ${C}" stroke-dashoffset="${C}"></circle>
        </svg>`;
      const inner=document.createElement('div'); inner.className='inner';
      inner.innerHTML=`<div class="icon">${cfg.icon}</div><div class="title">${cfg.title}</div><div class="meta" id="${kind}meta_${cfg.id}">0%</div>`;
      const help=document.createElement('div'); help.className='help'; help.textContent='?'; help.onclick=()=>openModal(cfg.title,cfg.explain);
      const badge=document.createElement('div'); badge.className='count-badge'+(kind==='warn'?' bad':''); badge.textContent='—';
      ringwrap.appendChild(inner); ringwrap.appendChild(help); ringwrap.appendChild(badge);
      card.appendChild(ringwrap); grid.appendChild(card);
      card._C=C; card._badge=badge;
    });
  }
  function updateCircleCard(kind,cfg){
    const card=document.getElementById(`${kind}_${cfg.id}`); if(!card) return;
    const C=card._C; const v=Math.max(0,Math.min(1,cfg.compute())); const offset=C*(1-v);
    document.getElementById(`${kind}prog_${cfg.id}`).style.strokeDashoffset=offset;
    document.getElementById(`${kind}meta_${cfg.id}`).textContent=Math.round(v*100)+'%';
  }
  function renderHonors(){ createCircleCard('honorsGrid',Honors,'hon'); updateHonors(); }
  function renderWarnings(){ createCircleCard('warningsGrid',Warnings,'warn'); updateWarnings(); }
  function renderScenes(){ createCircleCard('scenesGrid',Scenes,'scene'); updateScenes(); }
  function updateHonors(){ Honors.forEach(h=>updateCircleCard('hon',h)); }
  function updateWarnings(){ Warnings.forEach(w=>updateCircleCard('warn',w)); }
  function updateScenes(){ Scenes.forEach(s=>updateCircleCard('scene',s)); }

  /* =============== قسم القرآن (سورة أو صفحات) =============== */
  const TOTAL_QURAN_LETTERS=322604; // مجموع الحروف من بياناتك
  const TOTAL_QURAN_HASANAT=TOTAL_QURAN_LETTERS*10; // 3,226,040
  let quranHasanat=0; // المتراكم من القسم
  const surahData=[
    {n:1,  name:'الفاتحة',     letters:143},
    {n:2,  name:'البقرة',       letters:26246},
    {n:3,  name:'آل عمران',     letters:14985},
    {n:4,  name:'النساء',       letters:16334},
    {n:5,  name:'المائدة',      letters:12206},
    {n:6,  name:'الأنعام',      letters:12727},
    {n:7,  name:'الأعراف',      letters:14439},
    {n:8,  name:'الأنفال',      letters:5383},
    {n:9,  name:'التوبة',       letters:11115},
    {n:10, name:'يونس',         letters:7589},
    {n:11, name:'هود',          letters:7818},
    {n:12, name:'يوسف',         letters:7307},
    {n:13, name:'الرعد',        letters:3545},
    {n:14, name:'إبراهيم',      letters:3539},
    {n:15, name:'الحجر',        letters:2882},
    {n:16, name:'النحل',        letters:7832},
    {n:17, name:'الإسراء',      letters:6643},
    {n:18, name:'الكهف',        letters:6552},
    {n:19, name:'مريم',         letters:3935},
    {n:20, name:'طه',           letters:5399},
    {n:21, name:'الأنبياء',     letters:5094},
    {n:22, name:'الحج',         letters:5314},
    {n:23, name:'المؤمنون',     letters:4483},
    {n:24, name:'النور',        letters:5754},
    {n:25, name:'الفرقان',      letters:3877},
    {n:26, name:'الشعراء',      letters:5630},
    {n:27, name:'النمل',        letters:4792},
    {n:28, name:'القصص',        letters:5931},
    {n:29, name:'العنكبوت',     letters:4317},
    {n:30, name:'الروم',        letters:3473},
    {n:31, name:'لقمان',        letters:2171},
    {n:32, name:'السجدة',       letters:1563},
    {n:33, name:'الأحزاب',      letters:5788},
    {n:34, name:'سبأ',          letters:3594},
    {n:35, name:'فاطر',         letters:3238},
    {n:36, name:'يس',           letters:3068},
    {n:37, name:'الصافات',      letters:3899},
    {n:38, name:'ص',            letters:3066},
    {n:39, name:'الزمر',        letters:4869},
    {n:40, name:'غافر',         letters:5108},
    {n:41, name:'فصلت',         letters:3364},
    {n:42, name:'الشورى',       letters:3522},
    {n:43, name:'الزخرف',       letters:3610},
    {n:44, name:'الدخان',       letters:1474},
    {n:45, name:'الجاثية',      letters:2085},
    {n:46, name:'الأحقاف',      letters:2667},
    {n:47, name:'محمد',         letters:2423},
    {n:48, name:'الفتح',        letters:2510},
    {n:49, name:'الحجرات',      letters:1533},
    {n:50, name:'ق',            letters:1507},
    {n:51, name:'الذاريات',     letters:1546},
    {n:52, name:'الطور',        letters:1324},
    {n:53, name:'النجم',        letters:1433},
    {n:54, name:'القمر',        letters:1469},
    {n:55, name:'الرحمن',       letters:1648},
    {n:56, name:'الواقعة',      letters:1756},
    {n:57, name:'الحديد',       letters:2545},
    {n:58, name:'المجادلة',     letters:2046},
    {n:59, name:'الحشر',        letters:1970},
    {n:60, name:'الممتحنة',     letters:1560},
    {n:61, name:'الصف',         letters:966},
    {n:62, name:'الجمعة',       letters:768},
    {n:63, name:'المنافقون',    letters:801},
    {n:64, name:'التغابن',      letters:1091},
    {n:65, name:'الطلاق',       letters:1203},
    {n:66, name:'التحريم',      letters:1105},
    {n:67, name:'الملك',        letters:1347},
    {n:68, name:'القلم',        letters:1288},
    {n:69, name:'الحاقة',       letters:1133},
    {n:70, name:'المعارج',      letters:971},
    {n:71, name:'نوح',          letters:965},
    {n:72, name:'الجن',         letters:1109},
    {n:73, name:'المزمل',       letters:854},
    {n:74, name:'المدثر',       letters:1035},
    {n:75, name:'القيامة',      letters:677},
    {n:76, name:'الإنسان',      letters:1087},
    {n:77, name:'المرسلات',     letters:841},
    {n:78, name:'النبأ',        letters:796},
    {n:79, name:'النازعات',     letters:785},
    {n:80, name:'عبس',          letters:552},
    {n:81, name:'التكوير',      letters:435},
    {n:82, name:'الانفطار',     letters:333},
    {n:83, name:'المطففين',     letters:751},
    {n:84, name:'الانشقاق',     letters:445},
    {n:85, name:'البروج',       letters:469},
    {n:86, name:'الطارق',       letters:254},
    {n:87, name:'الأعلى',       letters:296},
    {n:88, name:'الغاشية',      letters:382},
    {n:89, name:'الفجر',        letters:584},
    {n:90, name:'البلد',        letters:342},
    {n:91, name:'الشمس',        letters:253},
    {n:92, name:'الليل',        letters:314},
    {n:93, name:'الضحى',        letters:165},
    {n:94, name:'الشرح',        letters:102},
    {n:95, name:'التين',        letters:162},
    {n:96, name:'العلق',        letters:288},
    {n:97, name:'القدر',        letters:115},
    {n:98, name:'البينة',       letters:404},
    {n:99, name:'الزلزلة',      letters:158},
    {n:100,name:'العاديات',     letters:169},
    {n:101,name:'القارعة',      letters:159},
    {n:102,name:'التكاثر',      letters:123},
    {n:103,name:'العصر',        letters:73},
    {n:104,name:'الهمزة',       letters:134},
    {n:105,name:'الفيل',        letters:97},
    {n:106,name:'قريش',        letters:77},
    {n:107,name:'الماعون',      letters:114},
    {n:108,name:'الكوثر',       letters:43},
    {n:109,name:'الكافرون',     letters:99},
    {n:110,name:'النصر',        letters:80},
    {n:111,name:'المسد',        letters:81},
    {n:112,name:'الإخلاص',      letters:47},
    {n:113,name:'الفلق',        letters:73},
    {n:114,name:'الناس',        letters:80},
  ];

  function populateSurahSelect(){
    const s=document.getElementById('surahSelect');
    s.innerHTML='';
    surahData.forEach(x=>{
      const o=document.createElement('option');
      o.value=x.n;
      o.textContent=`${x.n}. ${x.name} — ${x.letters} حرف`;
      s.appendChild(o);
    });
  }

  function updateQuranMode(){
    const mode=document.getElementById('qMode').value;
    document.getElementById('modeSurah').style.display=(mode==='surah')?'inline-flex':'none';
    document.getElementById('modePages').style.display=(mode==='pages')?'inline-flex':'none';
    recalcQuranPreview();
  }

  function recalcQuranPreview(){
    const mode=document.getElementById('qMode').value;
    let letters=0;
    if(mode==='surah'){
      const n=parseInt(document.getElementById('surahSelect').value||'1',10);
      const times=Math.max(1, parseInt(document.getElementById('surahTimes').value||'1',10));
      const s=surahData.find(x=>x.n===n);
      letters = (s?s.letters:0)*times;
    }else{
      const a=Math.min(604, Math.max(1, parseInt(document.getElementById('pageStart').value||'1',10)));
      const b=Math.min(604, Math.max(1, parseInt(document.getElementById('pageEnd').value||'1',10)));
      const pages = Math.max(0, (Math.max(a,b)-Math.min(a,b)+1));
      letters = pages*450; // حسب طلبك
    }
    const hasanat = letters*10;
    document.getElementById('qLetters').textContent=letters.toLocaleString('ar-EG');
    document.getElementById('qHasanat').textContent=hasanat.toLocaleString('ar-EG');

    // تقدُّم بالنسبة إلى الإجمالي الكلي لكل القرآن
    const prog = Math.min(100, (hasanat/TOTAL_QURAN_HASANAT)*100);
    document.getElementById('qBar').style.width = prog + '%';
    document.getElementById('qProgressText').textContent = hasanat.toLocaleString('ar-EG');
  }

  function addQuranHasanat(){
    const hasanat = parseInt((document.getElementById('qHasanat').textContent||'0').replace(/\D/g,''),10) || 0;
    if(!hasanat) return;
    quranHasanat += hasanat;           // لتتبع تأثير القرآن في الكرامات
    goodTotal += hasanat;              // تُضاف للحسنات العامة
    document.getElementById('goodTotal').textContent=goodTotal.toLocaleString('ar-EG');
    refreshUI();
  }

  /* =============== تحديث شامل =============== */
  function refreshUI(){
    updateNetResult(); updateGraveMeter(); autoUpdateFinalJudgment();
    updateHonors(); updateWarnings(); updateScenes();
  }

  /* =============== نافذة الشرح =============== */
  function openModal(title, body){
    document.getElementById('modalTitle').textContent=title;
    document.getElementById('modalBody').textContent=body;
    document.getElementById('modal').classList.add('active');
  }
  function closeModal(){ document.getElementById('modal').classList.remove('active'); }

  /* =============== تشغيل =============== */
  window.onload=()=>{
    populateDropdowns();
    // دوائر الأسباب
    (function renderReasons(){
      const gGrid=document.getElementById('reasonsGoodGrid');
      const bGrid=document.getElementById('reasonsBadGrid');
      REASONS_GOOD.forEach(r=>createReasonEl(r,'good',gGrid));
      REASONS_BAD.forEach(r=>createReasonEl(r,'bad',bGrid));
    })();
    // كرامات/تحذيرات/مشاهد
    renderHonors(); renderWarnings(); renderScenes();
    // القرآن
    populateSurahSelect();
    document.getElementById('surahSelect').addEventListener('change',recalcQuranPreview);
    document.getElementById('surahTimes').addEventListener('input',recalcQuranPreview);
    ['pageStart','pageEnd'].forEach(id=>document.getElementById(id).addEventListener('input',recalcQuranPreview));
    updateQuranMode();
    recalcQuranPreview();
    refreshUI();
  };
</script>
</body>
</html>
